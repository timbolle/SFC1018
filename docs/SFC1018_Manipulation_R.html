<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SFC1018 - Manipulation de données</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./SFC1018_Manipulation_R.html">Manipulation de données</a></li><li class="breadcrumb-item"><a href="./SFC1018_Manipulation_R.html">Manipulation de données</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">SFC1018</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Les bases</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SFC1018_Intro_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction à R</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Traitement de données</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SFC1018_Traitement_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Traitement de données avec R</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Manipulation de données</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SFC1018_Manipulation_R.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Manipulation de données</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-dplyr" id="toc-sec-dplyr" class="nav-link active" data-scroll-target="#sec-dplyr"><span class="header-section-number">1</span> Manipuler les données avec <code>dplyr</code></a>
  <ul>
  <li><a href="#préparation" id="toc-préparation" class="nav-link" data-scroll-target="#préparation"><span class="header-section-number">1.1</span> Préparation</a></li>
  <li><a href="#les-verbes-de-dplyr" id="toc-les-verbes-de-dplyr" class="nav-link" data-scroll-target="#les-verbes-de-dplyr"><span class="header-section-number">1.2</span> Les verbes de <code>dplyr</code></a>
  <ul class="collapse">
  <li><a href="#slice" id="toc-slice" class="nav-link" data-scroll-target="#slice"><span class="header-section-number">1.2.1</span> <code>slice</code></a></li>
  <li><a href="#sec-filter" id="toc-sec-filter" class="nav-link" data-scroll-target="#sec-filter"><span class="header-section-number">1.2.2</span> <code>filter</code></a></li>
  <li><a href="#sec-select-rename" id="toc-sec-select-rename" class="nav-link" data-scroll-target="#sec-select-rename"><span class="header-section-number">1.2.3</span> <code>select</code> et <code>rename</code></a></li>
  <li><a href="#arrange" id="toc-arrange" class="nav-link" data-scroll-target="#arrange"><span class="header-section-number">1.2.4</span> <code>arrange</code></a></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate"><span class="header-section-number">1.2.5</span> <code>mutate</code></a></li>
  </ul></li>
  <li><a href="#sec-pipe" id="toc-sec-pipe" class="nav-link" data-scroll-target="#sec-pipe"><span class="header-section-number">1.3</span> Enchaîner les opérations avec le <em>pipe</em></a></li>
  <li><a href="#opérations-groupées" id="toc-opérations-groupées" class="nav-link" data-scroll-target="#opérations-groupées"><span class="header-section-number">1.4</span> Opérations groupées</a>
  <ul class="collapse">
  <li><a href="#group_by" id="toc-group_by" class="nav-link" data-scroll-target="#group_by"><span class="header-section-number">1.4.1</span> <code>group_by</code></a></li>
  <li><a href="#summarise-et-count" id="toc-summarise-et-count" class="nav-link" data-scroll-target="#summarise-et-count"><span class="header-section-number">1.4.2</span> <code>summarise</code> et <code>count</code></a></li>
  <li><a href="#grouper-selon-plusieurs-variables" id="toc-grouper-selon-plusieurs-variables" class="nav-link" data-scroll-target="#grouper-selon-plusieurs-variables"><span class="header-section-number">1.4.3</span> Grouper selon plusieurs variables</a></li>
  <li><a href="#dégroupage" id="toc-dégroupage" class="nav-link" data-scroll-target="#dégroupage"><span class="header-section-number">1.4.4</span> Dégroupage</a></li>
  </ul></li>
  <li><a href="#autres-fonctions-utiles" id="toc-autres-fonctions-utiles" class="nav-link" data-scroll-target="#autres-fonctions-utiles"><span class="header-section-number">1.5</span> Autres fonctions utiles</a>
  <ul class="collapse">
  <li><a href="#slice_sample" id="toc-slice_sample" class="nav-link" data-scroll-target="#slice_sample"><span class="header-section-number">1.5.1</span> <code>slice_sample</code></a></li>
  <li><a href="#lead-et-lag" id="toc-lead-et-lag" class="nav-link" data-scroll-target="#lead-et-lag"><span class="header-section-number">1.5.2</span> <code>lead</code> et <code>lag</code></a></li>
  <li><a href="#distinct-et-n_distinct" id="toc-distinct-et-n_distinct" class="nav-link" data-scroll-target="#distinct-et-n_distinct"><span class="header-section-number">1.5.3</span> <code>distinct</code> et <code>n_distinct</code></a></li>
  <li><a href="#relocate" id="toc-relocate" class="nav-link" data-scroll-target="#relocate"><span class="header-section-number">1.5.4</span> <code>relocate</code></a></li>
  </ul></li>
  <li><a href="#tables-multiples" id="toc-tables-multiples" class="nav-link" data-scroll-target="#tables-multiples"><span class="header-section-number">1.6</span> Tables multiples</a>
  <ul class="collapse">
  <li><a href="#concaténation-bind_rows-et-bind_cols" id="toc-concaténation-bind_rows-et-bind_cols" class="nav-link" data-scroll-target="#concaténation-bind_rows-et-bind_cols"><span class="header-section-number">1.6.1</span> Concaténation&nbsp;: <code>bind_rows</code> et <code>bind_cols</code></a></li>
  <li><a href="#jointures" id="toc-jointures" class="nav-link" data-scroll-target="#jointures"><span class="header-section-number">1.6.2</span> Jointures</a>
  <ul class="collapse">
  <li><a href="#clés-implicites" id="toc-clés-implicites" class="nav-link" data-scroll-target="#clés-implicites"><span class="header-section-number">1.6.2.1</span> Clés implicites</a></li>
  <li><a href="#clés-explicites" id="toc-clés-explicites" class="nav-link" data-scroll-target="#clés-explicites"><span class="header-section-number">1.6.2.2</span> Clés explicites</a></li>
  </ul></li>
  <li><a href="#types-de-jointures" id="toc-types-de-jointures" class="nav-link" data-scroll-target="#types-de-jointures"><span class="header-section-number">1.6.3</span> Types de jointures</a>
  <ul class="collapse">
  <li><a href="#left_join" id="toc-left_join" class="nav-link" data-scroll-target="#left_join"><span class="header-section-number">1.6.3.1</span> left_join</a></li>
  <li><a href="#right_join" id="toc-right_join" class="nav-link" data-scroll-target="#right_join"><span class="header-section-number">1.6.3.2</span> right_join</a></li>
  <li><a href="#inner_join" id="toc-inner_join" class="nav-link" data-scroll-target="#inner_join"><span class="header-section-number">1.6.3.3</span> inner_join</a></li>
  <li><a href="#full_join" id="toc-full_join" class="nav-link" data-scroll-target="#full_join"><span class="header-section-number">1.6.3.4</span> full_join</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#ressources" id="toc-ressources" class="nav-link" data-scroll-target="#ressources"><span class="header-section-number">1.7</span> Ressources</a></li>
  <li><a href="#exercices" id="toc-exercices" class="nav-link" data-scroll-target="#exercices"><span class="header-section-number">1.8</span> Exercices</a>
  <ul class="collapse">
  <li><a href="#les-verbes-de-base-de-dplyr" id="toc-les-verbes-de-base-de-dplyr" class="nav-link" data-scroll-target="#les-verbes-de-base-de-dplyr"><span class="header-section-number">1.8.1</span> Les verbes de base de <code>dplyr</code></a></li>
  <li><a href="#enchaîner-des-opérations" id="toc-enchaîner-des-opérations" class="nav-link" data-scroll-target="#enchaîner-des-opérations"><span class="header-section-number">1.8.2</span> Enchaîner des opérations</a></li>
  <li><a href="#group_by-et-summarise" id="toc-group_by-et-summarise" class="nav-link" data-scroll-target="#group_by-et-summarise"><span class="header-section-number">1.8.3</span> <code>group_by</code> et <code>summarise</code></a></li>
  <li><a href="#jointures-1" id="toc-jointures-1" class="nav-link" data-scroll-target="#jointures-1"><span class="header-section-number">1.8.4</span> Jointures</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./SFC1018_Manipulation_R.html">Manipulation de données</a></li><li class="breadcrumb-item"><a href="./SFC1018_Manipulation_R.html">Manipulation de données</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Manipulation de données</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="sec-dplyr" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Manipuler les données avec <code>dplyr</code></h1>
<p><code>dplyr</code> est une extension facilitant le traitement et la manipulation de données contenues dans une ou plusieurs tables. Elle propose une syntaxe claire et cohérente, sous formes de verbes, pour la plupart des opérations de ce type.</p>
<p><code>dplyr</code> part du principe que les données sont organisées selon le modèle des <em>tidy data</em> (que nous verrons plus tard). Les fonctions de l’extension peuvent s’appliquer à des tableaux de type <code>data.frame</code> ou <code>tibble</code>, et elles retournent systématiquement un <code>tibble</code>.</p>
<p>Le code présent dans ce document nécessite d’avoir installé <code>dplyr</code>.</p>
<section id="préparation" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="préparation"><span class="header-section-number">1.1</span> Préparation</h2>
<p><code>dplyr</code> fait partie du coeur du <em>tidyverse</em>, elle est donc chargée automatiquement avec&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut également la charger individuellement.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dans ce qui suit on va utiliser le jeu de données <code>nycflights13</code>, contenu dans l’extension du même nom (qu’il faut donc avoir installé). Celui-ci correspond aux données de tous les vols au départ d’un des trois aéroports de New-York en 2013. Il a la particularité d’être réparti en trois tables&nbsp;:</p>
<ul>
<li><code>flights</code> contient des informations sur les vols&nbsp;: date, départ, destination, horaires, retard…</li>
<li><code>airports</code> contient des informations sur les aéroports</li>
<li><code>airlines</code> contient des données sur les compagnies aériennes</li>
</ul>
<p>On va charger les trois tables du jeu de données&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Chargement des trois tables</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(flights)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(airports)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(airlines)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Trois objets correspondant aux trois tables ont dû apparaître dans votre environnement.</p>
</section>
<section id="les-verbes-de-dplyr" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="les-verbes-de-dplyr"><span class="header-section-number">1.2</span> Les verbes de <code>dplyr</code></h2>
<p>La manipulation de données avec <code>dplyr</code> se fait en utilisant un nombre réduit de verbes, qui correspondent chacun à une action différente appliquée à un tableau de données.</p>
<section id="slice" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="slice"><span class="header-section-number">1.2.1</span> <code>slice</code></h3>
<p>Le verbe <code>slice</code> sélectionne des lignes du tableau selon leur position. On lui passe un chiffre ou un vecteur de chiffres.</p>
<p>Si on souhaite sélectionner la 345e ligne du tableau <code>airports</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice</span>(airports, <span class="dv">345</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 8
  faa   name                lat   lon   alt    tz dst   tzone            
  &lt;chr&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;            
1 CYF   Chefornak Airport  60.1 -164.    40    -9 A     America/Anchorage</code></pre>
</div>
</div>
<p>Si on veut sélectionner les 5 premières lignes&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice</span>(airports, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 8
  faa   name                            lat   lon   alt    tz dst   tzone       
  &lt;chr&gt; &lt;chr&gt;                         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;       
1 04G   Lansdowne Airport              41.1 -80.6  1044    -5 A     America/New…
2 06A   Moton Field Municipal Airport  32.5 -85.7   264    -6 A     America/Chi…
3 06C   Schaumburg Regional            42.0 -88.1   801    -6 A     America/Chi…
4 06N   Randall Airport                41.4 -74.4   523    -5 A     America/New…
5 09J   Jekyll Island Airport          31.1 -81.4    11    -5 A     America/New…</code></pre>
</div>
</div>
<p><code>slice</code> propose plusieurs variantes utiles, dont <code>slice_head</code> et <code>slice_tail</code>, qui permettent de sélectionner les premières ou les dernières lignes du tableau (on peut spécifier le nombre de lignes souhaitées avec <code>n</code>, ou la proportion avec <code>prop</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_tail</span>(airports, <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 8
  faa   name                        lat   lon   alt    tz dst   tzone           
  &lt;chr&gt; &lt;chr&gt;                     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;           
1 ZWI   Wilmington Amtrak Station  39.7 -75.6     0    -5 A     America/New_York
2 ZWU   Washington Union Station   38.9 -77.0    76    -5 A     America/New_York
3 ZYP   Penn Station               40.8 -74.0    35    -5 A     America/New_York</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_head</span>(airlines, <span class="at">prop =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  carrier name                  
  &lt;chr&gt;   &lt;chr&gt;                 
1 9E      Endeavor Air Inc.     
2 AA      American Airlines Inc.
3 AS      Alaska Airlines Inc.  </code></pre>
</div>
</div>
<p>Autres variantes utiles, <code>slice_min</code> et <code>slice_max</code> permettent de sélectionner les lignes avec les valeurs les plus grandes ou les plus petite d’une variable donnée. Ainsi, la commande suivante sélectionne le vol ayant le retard au départ le plus faible.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_min</span>(flights, dep_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 19
   year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
1  2013    12     7     2040           2123       -43       40           2352
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<p>On peut aussi spécifier le nombre de lignes souhaitées, par exemple la commande suivante retourne les 5 aéroports avec l’altitude la plus élevée (en cas de valeurs ex-aequo, il se peut que le nombre de lignes retournées soit plus élevé que celui demandé).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(airports, alt, <span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 8
  faa   name                              lat   lon   alt    tz dst   tzone     
  &lt;chr&gt; &lt;chr&gt;                           &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     
1 TEX   Telluride                        38.0 -108.  9078    -7 A     America/D…
2 TVL   Lake Tahoe Airport               38.9 -120.  8544    -8 A     America/L…
3 ASE   Aspen Pitkin County Sardy Field  39.2 -107.  7820    -7 A     America/D…
4 GUC   Gunnison - Crested Butte         38.5 -107.  7678    -7 A     America/D…
5 BCE   Bryce Canyon                     37.7 -112.  7590    -7 A     America/D…</code></pre>
</div>
</div>
</section>
<section id="sec-filter" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="sec-filter"><span class="header-section-number">1.2.2</span> <code>filter</code></h3>
<p><code>filter</code> sélectionne des lignes d’une table selon une condition. On lui passe en paramètre un test, et seules les lignes pour lesquelles ce test renvoie <code>TRUE</code> (vrai) sont conservées.</p>
<p>Par exemple, si on veut sélectionner les vols du mois de janvier, on peut filtrer sur la variable <code>month</code> de la manière suivante&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights, month <span class="sc">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 27,004 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 26,994 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<p>Si on veut uniquement les vols avec un retard au départ (variable <code>dep_delay</code>) compris entre 10 et 15 minutes&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights, dep_delay <span class="sc">&gt;=</span> <span class="dv">10</span> <span class="sc">&amp;</span> dep_delay <span class="sc">&lt;=</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14,919 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      611            600        11      945            931
 2  2013     1     1      623            610        13      920            915
 3  2013     1     1      743            730        13     1107           1100
 4  2013     1     1      743            730        13     1059           1056
 5  2013     1     1      851            840        11     1215           1206
 6  2013     1     1      912            900        12     1241           1220
 7  2013     1     1      914            900        14     1058           1043
 8  2013     1     1      920            905        15     1039           1025
 9  2013     1     1     1011           1001        10     1133           1128
10  2013     1     1     1112           1100        12     1440           1438
# ℹ 14,909 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<p>Si on passe plusieurs arguments à <code>filter</code>, celui-ci rajoute automatiquement une condition <em>et</em> entre les conditions. La commande précédente peut donc être écrite de la manière suivante, avec le même résultat&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights, dep_delay <span class="sc">&gt;=</span> <span class="dv">10</span>, dep_delay <span class="sc">&lt;=</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut également placer des fonctions dans les tests, qui nous permettent par exemple de sélectionner les vols ayant une distance supérieure à la distance médiane&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights, distance <span class="sc">&gt;</span> <span class="fu">median</span>(distance))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 167,133 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      555            600        -5      913            854
 6  2013     1     1      557            600        -3      838            846
 7  2013     1     1      558            600        -2      849            851
 8  2013     1     1      558            600        -2      853            856
 9  2013     1     1      558            600        -2      924            917
10  2013     1     1      558            600        -2      923            937
# ℹ 167,123 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</section>
<section id="sec-select-rename" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="sec-select-rename"><span class="header-section-number">1.2.3</span> <code>select</code> et <code>rename</code></h3>
<p><code>select</code> permet de sélectionner des colonnes d’un tableau de données. Ainsi, si on veut extraire les colonnes <code>lat</code> et <code>lon</code> du tableau airports&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(airports, lat, lon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,458 × 2
     lat    lon
   &lt;dbl&gt;  &lt;dbl&gt;
 1  41.1  -80.6
 2  32.5  -85.7
 3  42.0  -88.1
 4  41.4  -74.4
 5  31.1  -81.4
 6  36.4  -82.2
 7  41.5  -84.5
 8  42.9  -76.8
 9  39.8  -76.6
10  48.1 -123. 
# ℹ 1,448 more rows</code></pre>
</div>
</div>
<p>Si on fait précéder le nom d’un <code>-</code>, la colonne est éliminée plutôt que sélectionnée&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(airports, <span class="sc">-</span>lat, <span class="sc">-</span>lon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,458 × 6
   faa   name                             alt    tz dst   tzone              
   &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;              
 1 04G   Lansdowne Airport               1044    -5 A     America/New_York   
 2 06A   Moton Field Municipal Airport    264    -6 A     America/Chicago    
 3 06C   Schaumburg Regional              801    -6 A     America/Chicago    
 4 06N   Randall Airport                  523    -5 A     America/New_York   
 5 09J   Jekyll Island Airport             11    -5 A     America/New_York   
 6 0A9   Elizabethton Municipal Airport  1593    -5 A     America/New_York   
 7 0G6   Williams County Airport          730    -5 A     America/New_York   
 8 0G7   Finger Lakes Regional Airport    492    -5 A     America/New_York   
 9 0P2   Shoestring Aviation Airfield    1000    -5 U     America/New_York   
10 0S9   Jefferson County Intl            108    -8 A     America/Los_Angeles
# ℹ 1,448 more rows</code></pre>
</div>
</div>
<p><code>select</code> comprend toute une série de fonctions facilitant la sélection de colonnes multiples. Par exemple, <code>starts_with</code>, <code>ends_width</code>, <code>contains</code> ou <code>matches</code> permettent d’exprimer des conditions sur les noms de variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights, <span class="fu">starts_with</span>(<span class="st">"dep_"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 2
   dep_time dep_delay
      &lt;int&gt;     &lt;dbl&gt;
 1      517         2
 2      533         4
 3      542         2
 4      544        -1
 5      554        -6
 6      554        -4
 7      555        -5
 8      557        -3
 9      557        -3
10      558        -2
# ℹ 336,766 more rows</code></pre>
</div>
</div>
<p>La syntaxe <code>colonne1:colonne2</code> permet de sélectionner toutes les colonnes situées entre <code>colonne1</code> et <code>colonne2</code> incluses<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights, year<span class="sc">:</span>day)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 3
    year month   day
   &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1  2013     1     1
 2  2013     1     1
 3  2013     1     1
 4  2013     1     1
 5  2013     1     1
 6  2013     1     1
 7  2013     1     1
 8  2013     1     1
 9  2013     1     1
10  2013     1     1
# ℹ 336,766 more rows</code></pre>
</div>
</div>
<p><code>select</code> propose de nombreuses autres possibilités de sélection qui sont décrites dans <a href="https://tidyselect.r-lib.org/reference/language.html">la documentation de l’extension <code>tidyselect</code></a>.</p>
<p>Une variante de <code>select</code> est <code>rename</code><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>, qui permet de renommer des colonnes. On l’utilise en lui passant des paramètres de la forme <code>nouveau_nom = ancien_nom</code>. Ainsi, si on veut renommer les colonnes <code>lon</code> et <code>lat</code> de <code>airports</code> en <code>longitude</code> et <code>latitude</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(airports, <span class="at">longitude =</span> lon, <span class="at">latitude =</span> lat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,458 × 8
   faa   name                         latitude longitude   alt    tz dst   tzone
   &lt;chr&gt; &lt;chr&gt;                           &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
 1 04G   Lansdowne Airport                41.1     -80.6  1044    -5 A     Amer…
 2 06A   Moton Field Municipal Airpo…     32.5     -85.7   264    -6 A     Amer…
 3 06C   Schaumburg Regional              42.0     -88.1   801    -6 A     Amer…
 4 06N   Randall Airport                  41.4     -74.4   523    -5 A     Amer…
 5 09J   Jekyll Island Airport            31.1     -81.4    11    -5 A     Amer…
 6 0A9   Elizabethton Municipal Airp…     36.4     -82.2  1593    -5 A     Amer…
 7 0G6   Williams County Airport          41.5     -84.5   730    -5 A     Amer…
 8 0G7   Finger Lakes Regional Airpo…     42.9     -76.8   492    -5 A     Amer…
 9 0P2   Shoestring Aviation Airfield     39.8     -76.6  1000    -5 U     Amer…
10 0S9   Jefferson County Intl            48.1    -123.    108    -8 A     Amer…
# ℹ 1,448 more rows</code></pre>
</div>
</div>
<p>Si les noms de colonnes comportent des espaces ou des caractères spéciaux, on peut les entourer de guillemets (<code>"</code>) ou de quotes inverses (<code>`</code>)&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">rename</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    flights,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"retard départ"</span> <span class="ot">=</span> dep_delay,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"retard arrivée"</span> <span class="ot">=</span> arr_delay</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(tmp, <span class="st">`</span><span class="at">retard départ</span><span class="st">`</span>, <span class="st">`</span><span class="at">retard arrivée</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 2
   `retard départ` `retard arrivée`
             &lt;dbl&gt;            &lt;dbl&gt;
 1               2               11
 2               4               20
 3               2               33
 4              -1              -18
 5              -6              -25
 6              -4               12
 7              -5               19
 8              -3              -14
 9              -3               -8
10              -2                8
# ℹ 336,766 more rows</code></pre>
</div>
</div>
</section>
<section id="arrange" class="level3" data-number="1.2.4">
<h3 data-number="1.2.4" class="anchored" data-anchor-id="arrange"><span class="header-section-number">1.2.4</span> <code>arrange</code></h3>
<p><code>arrange</code> réordonne les lignes d’un tableau selon une ou plusieurs colonnes.</p>
<p>Ainsi, si on veut trier le tableau <code>flights</code> selon le retard au départ croissant&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(flights, dep_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013    12     7     2040           2123       -43       40           2352
 2  2013     2     3     2022           2055       -33     2240           2338
 3  2013    11    10     1408           1440       -32     1549           1559
 4  2013     1    11     1900           1930       -30     2233           2243
 5  2013     1    29     1703           1730       -27     1947           1957
 6  2013     8     9      729            755       -26     1002            955
 7  2013    10    23     1907           1932       -25     2143           2143
 8  2013     3    30     2030           2055       -25     2213           2250
 9  2013     3     2     1431           1455       -24     1601           1631
10  2013     5     5      934            958       -24     1225           1309
# ℹ 336,766 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<p>On peut trier selon plusieurs colonnes. Par exemple selon le mois, puis selon le retard au départ&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(flights, month, dep_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1    11     1900           1930       -30     2233           2243
 2  2013     1    29     1703           1730       -27     1947           1957
 3  2013     1    12     1354           1416       -22     1606           1650
 4  2013     1    21     2137           2159       -22     2232           2316
 5  2013     1    20      704            725       -21     1025           1035
 6  2013     1    12     2050           2110       -20     2310           2355
 7  2013     1    12     2134           2154       -20        4             50
 8  2013     1    14     2050           2110       -20     2329           2355
 9  2013     1     4     2140           2159       -19     2241           2316
10  2013     1    11     1947           2005       -18     2209           2230
# ℹ 336,766 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<p>Si on veut trier selon une colonne par ordre décroissant, on lui applique la fonction <code>desc()</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(flights, <span class="fu">desc</span>(dep_delay))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     9      641            900      1301     1242           1530
 2  2013     6    15     1432           1935      1137     1607           2120
 3  2013     1    10     1121           1635      1126     1239           1810
 4  2013     9    20     1139           1845      1014     1457           2210
 5  2013     7    22      845           1600      1005     1044           1815
 6  2013     4    10     1100           1900       960     1342           2211
 7  2013     3    17     2321            810       911      135           1020
 8  2013     6    27      959           1900       899     1236           2226
 9  2013     7    22     2257            759       898      121           1026
10  2013    12     5      756           1700       896     1058           2020
# ℹ 336,766 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<p>Combiné avec <code>slice</code>, <code>arrange</code> permet par exemple de sélectionner les trois vols ayant eu le plus de retard&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">arrange</span>(flights, <span class="fu">desc</span>(dep_delay))</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">slice</span>(tmp, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 19
   year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
1  2013     1     9      641            900      1301     1242           1530
2  2013     6    15     1432           1935      1137     1607           2120
3  2013     1    10     1121           1635      1126     1239           1810
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</section>
<section id="mutate" class="level3" data-number="1.2.5">
<h3 data-number="1.2.5" class="anchored" data-anchor-id="mutate"><span class="header-section-number">1.2.5</span> <code>mutate</code></h3>
<p><code>mutate</code> permet de créer de nouvelles colonnes dans le tableau de données, en général à partir de variables existantes.</p>
<p>Par exemple, la table <code>flights</code> contient la durée du vol en minutes.. Si on veut créer une nouvelle variable <code>duree_h</code> avec cette durée en heures, on peut faire&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>flights <span class="ot">&lt;-</span> <span class="fu">mutate</span>(flights, <span class="at">duree_h =</span> air_time <span class="sc">/</span> <span class="dv">60</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights, air_time, duree_h)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 2
   air_time duree_h
      &lt;dbl&gt;   &lt;dbl&gt;
 1      227   3.78 
 2      227   3.78 
 3      160   2.67 
 4      183   3.05 
 5      116   1.93 
 6      150   2.5  
 7      158   2.63 
 8       53   0.883
 9      140   2.33 
10      138   2.3  
# ℹ 336,766 more rows</code></pre>
</div>
</div>
<p>On peut créer plusieurs nouvelles colonnes en une seule commande, et les expressions successives peuvent prendre en compte les résultats des calculs précédents. L’exemple suivant convertit d’abord la durée en heures dans une variable <code>duree_h</code> et la distance en kilomètres dans une variable <code>distance_km</code>, puis utilise ces nouvelles colonnes pour calculer la vitesse en km/h.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>flights <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    flights,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">duree_h =</span> air_time <span class="sc">/</span> <span class="dv">60</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance_km =</span> distance <span class="sc">/</span> <span class="fl">0.62137</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">vitesse =</span> distance_km <span class="sc">/</span> duree_h</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights, air_time, duree_h, distance, distance_km, vitesse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 5
   air_time duree_h distance distance_km vitesse
      &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;
 1      227   3.78      1400       2253.    596.
 2      227   3.78      1416       2279.    602.
 3      160   2.67      1089       1753.    657.
 4      183   3.05      1576       2536.    832.
 5      116   1.93       762       1226.    634.
 6      150   2.5        719       1157.    463.
 7      158   2.63      1065       1714.    651.
 8       53   0.883      229        369.    417.
 9      140   2.33       944       1519.    651.
10      138   2.3        733       1180.    513.
# ℹ 336,766 more rows</code></pre>
</div>
</div>
<p>À noter que <code>mutate</code> est évidemment parfaitement compatible avec les fonctions vues sur les recodages&nbsp;: <code>fct_recode</code>, <code>ifelse</code>, <code>case_when</code>…</p>
<p>L’avantage d’utiliser <code>mutate</code> est double. D’abord il permet d’éviter d’avoir à saisir le nom du tableau de données dans les conditions d’un <code>ifelse</code> ou d’un <code>case_when</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>flights <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    flights,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">type_retard =</span> <span class="fu">case_when</span>(</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>        dep_delay <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> arr_delay <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Retard départ et arrivée"</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>        dep_delay <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> arr_delay <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Retard départ"</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>        dep_delay <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> arr_delay <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Retard arrivée"</span>,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Aucun retard"</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ensuite, il permet aussi d’intégrer ces recodages dans un <em>pipeline</em> de traitement de données, concept présenté dans la section suivante.</p>
</section>
</section>
<section id="sec-pipe" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="sec-pipe"><span class="header-section-number">1.3</span> Enchaîner les opérations avec le <em>pipe</em></h2>
<p>Quand on manipule un tableau de données, il est très fréquent d’enchaîner plusieurs opérations. On va par exemple extraire une sous-population avec <code>filter</code>, sélectionner des colonnes avec <code>select</code> puis trier selon une variable avec <code>arrange</code>, etc.</p>
<p>Quand on veut enchaîner des opérations, on peut le faire de différentes manières. La première est d’effectuer toutes les opérations en une fois en les “emboîtant”&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(<span class="fu">select</span>(<span class="fu">filter</span>(flights, dest <span class="sc">==</span> <span class="st">"LAX"</span>), dep_delay, arr_delay), dep_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cette notation a plusieurs inconvénients&nbsp;:</p>
<ul>
<li>elle est peu lisible</li>
<li>les opérations apparaissent dans l’ordre inverse de leur réalisation. Ici on effectue d’abord le <code>filter</code>, puis le <code>select</code>, puis le <code>arrange</code>, alors qu’à la lecture du code c’est le <code>arrange</code> qui apparaît en premier.</li>
<li>Il est difficile de voir quel paramètre se rapporte à quelle fonction</li>
</ul>
<p>Une autre manière de faire est d’effectuer les opérations les unes après les autres, en stockant les résultats intermédiaires dans un objet temporaire&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">filter</span>(flights, dest <span class="sc">==</span> <span class="st">"LAX"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">select</span>(tmp, dep_delay, arr_delay)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(tmp, dep_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>C’est nettement plus lisible, l’ordre des opérations est le bon, et les paramètres sont bien rattachés à leur fonction. Par contre, ça reste un peu “verbeux”, et on crée un objet temporaire <code>tmp</code> dont on n’a pas réellement besoin.</p>
<p>Pour simplifier et améliorer encore la lisibilité du code, on va utiliser un nouvel opérateur, baptisé <em>pipe</em><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Le <em>pipe</em> se note <code>%&gt;%</code>, et son fonctionnement est le suivant&nbsp;: si j’exécute <code>expr %&gt;% f</code>, alors le résultat de l’expression <code>expr</code>, à gauche du <em>pipe</em>, sera passé comme premier argument à la fonction <code>f</code>, à droite du <em>pipe</em>, ce qui revient à exécuter <code>f(expr)</code>.</p>
<p>Ainsi les deux expressions suivantes sont rigoureusement équivalentes&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights, dest <span class="sc">==</span> <span class="st">"LAX"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"LAX"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ce qui est particulièrement intéressant, c’est qu’on va pouvoir enchaîner les <em>pipes</em>. Plutôt que d’écrire&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="fu">filter</span>(flights, dest <span class="sc">==</span> <span class="st">"LAX"</span>), dep_delay, arr_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On va pouvoir faire&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"LAX"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(dep_delay, arr_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>À chaque fois, le résultat de ce qui se trouve à gauche du <em>pipe</em> est passé comme premier argument à ce qui se trouve à droite&nbsp;: on part de l’objet <code>flights</code>, qu’on passe comme premier argument à la fonction <code>filter</code>, puis on passe le résultat de ce <code>filter</code> comme premier argument du <code>select</code>.</p>
<p>Le résultat final est le même avec les deux syntaxes, mais avec le <em>pipe</em> l’ordre des opérations correspond à l’ordre naturel de leur exécution, et on n’a pas eu besoin de créer d’objet intermédiaire.</p>
<p>Si la liste des fonctions enchaînées est longue, on peut les répartir sur plusieurs lignes à condition que l’opérateur <code>%&gt;%</code> soit en fin de ligne&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"LAX"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_delay, arr_delay) <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(dep_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>On appelle une suite d’instructions de ce type un <em>pipeline</em>.</p>
</div>
</div>
<p>Évidemment, il est naturel de vouloir récupérer le résultat final d’un <em>pipeline</em> pour le stocker dans un objet. On peut stocker le résultat du <em>pipeline</em> ci-dessus dans un nouveau tableau <code>delay_la</code> de la manière suivante&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>delay_la <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"LAX"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_delay, arr_delay) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(dep_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dans ce cas, <code>delay_la</code> contiendra le tableau final, obtenu après application des trois instructions <code>filter</code>, <code>select</code> et <code>arrange</code>.</p>
<p>Cette notation n’est pas forcément très intuitive au départ : il faut bien comprendre que c’est le résultat final, une fois application de toutes les opérations du <em>pipeline</em>, qui est renvoyé et stocké dans l’objet en début de ligne.</p>
<p>Une manière de le comprendre peut être de voir que la notation suivante&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>delay_la <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"LAX"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_delay, arr_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>est équivalente à&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>delay_la <span class="ot">&lt;-</span> (flights <span class="sc">%&gt;%</span> <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"LAX"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(dep_delay, arr_delay))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>L’utilisation du <em>pipe</em> n’est pas obligatoire, mais elle rend les scripts plus lisibles et plus rapides à saisir. On l’utilisera donc dans ce qui suit.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Depuis la version 4.1, R propose un <em>pipe</em> “natif”, qui fonctionne partout, même si on n’utilise pas les extensions du <em>tidyverse</em>. Celui-ci est noté <code>|&gt;</code>.</p>
<p>Il s’utilise de la même manière que <code>%&gt;%</code> :</p>
<p><code>flights |&gt; filter(dest == "LAX")</code></p>
<p>Ce <em>pipe</em> natif est à la fois un peu plus rapide et un peu moins souple. Par exemple, il est possible avec <code>%&gt;%</code> d’appeler une fonction sans mettre de parenthèses :</p>
<p><code>df %&gt;% View</code></p>
<p>Ce n’est pas possible d’omettre les parenthèses avec <code>|&gt;</code>, on doit obligatoirement faire :</p>
<p><code>df |&gt; View()</code></p>
<p>Dans la suite de ce document on privilégiera (pour l’instant) le <em>pipe</em> du <em>tidyverse</em> <code>%&gt;%</code>, pour des raisons de compatibilité avec des versions de R moins récentes.</p>
</div>
</div>
</section>
<section id="opérations-groupées" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="opérations-groupées"><span class="header-section-number">1.4</span> Opérations groupées</h2>
<section id="group_by" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="group_by"><span class="header-section-number">1.4.1</span> <code>group_by</code></h3>
<p>Un élément très important de <code>dplyr</code> est la fonction <code>group_by</code>. Elle permet de définir des groupes de lignes à partir des valeurs d’une ou plusieurs colonnes. Par exemple, on peut grouper les vols selon leur mois&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 22
# Groups:   month [12]
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 336,766 more rows
# ℹ 14 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, duree_h &lt;dbl&gt;,
#   distance_km &lt;dbl&gt;, vitesse &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Par défaut ceci ne fait rien de visible, à part l’apparition d’une mention <code>Groups</code> dans l’affichage du résultat. Mais à partir du moment où des groupes ont été définis, les verbes comme <code>slice</code>, <code>mutate</code> ou <code>summarise</code> vont en tenir compte lors de leurs opérations.</p>
<p>Par exemple, si on applique <code>slice</code> à un tableau préalablement groupé, il va sélectionner les lignes aux positions indiquées <em>pour chaque groupe</em>. Ainsi la commande suivante affiche le premier vol de chaque mois, selon leur ordre d’apparition dans le tableau&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 22
# Groups:   month [12]
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     2     1      456            500        -4      652            648
 3  2013     3     1        4           2159       125      318             56
 4  2013     4     1      454            500        -6      636            640
 5  2013     5     1        9           1655       434      308           2020
 6  2013     6     1        2           2359         3      341            350
 7  2013     7     1        1           2029       212      236           2359
 8  2013     8     1       12           2130       162      257             14
 9  2013     9     1        9           2359        10      343            340
10  2013    10     1      447            500       -13      614            648
11  2013    11     1        5           2359         6      352            345
12  2013    12     1       13           2359        14      446            445
# ℹ 14 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, duree_h &lt;dbl&gt;,
#   distance_km &lt;dbl&gt;, vitesse &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Plus utile, en utilisant une variante comme <code>slice_min</code> ou <code>slice_max</code>, on peut sélectionner les lignes ayant les valeurs les plus grandes ou les plus petites <em>pour chaque groupe</em>. Par exemple la commande suivant sélectionne, pour chaque mois de l’année, le vol ayant eu le retard le plus important.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(dep_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 22
# Groups:   month [12]
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     9      641            900      1301     1242           1530
 2  2013     2    10     2243            830       853      100           1106
 3  2013     3    17     2321            810       911      135           1020
 4  2013     4    10     1100           1900       960     1342           2211
 5  2013     5     3     1133           2055       878     1250           2215
 6  2013     6    15     1432           1935      1137     1607           2120
 7  2013     7    22      845           1600      1005     1044           1815
 8  2013     8     8     2334           1454       520      120           1710
 9  2013     9    20     1139           1845      1014     1457           2210
10  2013    10    14     2042            900       702     2255           1127
11  2013    11     3      603           1645       798      829           1913
12  2013    12     5      756           1700       896     1058           2020
# ℹ 14 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, duree_h &lt;dbl&gt;,
#   distance_km &lt;dbl&gt;, vitesse &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Idem pour <code>mutate</code>&nbsp;: les opérations appliquées lors du calcul des valeurs des nouvelles colonnes sont appliquées groupe de lignes par groupe de lignes. Dans l’exemple suivant, on ajoute une nouvelle colonne qui contient le retard moyen <em>pour chaque compagnie aérienne</em>. Cette valeur est donc différente d’une compagnie à une autre, mais identique pour tous les vols d’une même compagnie&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(carrier) <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_delay_carrier =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_delay, mean_delay_carrier)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `carrier`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 3
# Groups:   carrier [16]
   carrier dep_delay mean_delay_carrier
   &lt;chr&gt;       &lt;dbl&gt;              &lt;dbl&gt;
 1 UA              2              12.1 
 2 UA              4              12.1 
 3 AA              2               8.59
 4 B6             -1              13.0 
 5 DL             -6               9.26
 6 UA             -4              12.1 
 7 B6             -5              13.0 
 8 EV             -3              20.0 
 9 B6             -3              13.0 
10 AA             -2               8.59
# ℹ 336,766 more rows</code></pre>
</div>
</div>
<p>Ceci peut permettre, par exemple, de déterminer si un retard donné est supérieur ou inférieur au retard médian de la compagnie&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(carrier) <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">median_delay =</span> <span class="fu">median</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">delay_carrier =</span> <span class="fu">ifelse</span>(</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>          dep_delay <span class="sc">&gt;</span> median_delay,</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Supérieur"</span>,</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inférieur ou égal"</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_delay, median_delay, delay_carrier)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `carrier`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 4
# Groups:   carrier [16]
   carrier dep_delay median_delay delay_carrier    
   &lt;chr&gt;       &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt;            
 1 UA              2            0 Supérieur        
 2 UA              4            0 Supérieur        
 3 AA              2           -3 Supérieur        
 4 B6             -1           -1 Inférieur ou égal
 5 DL             -6           -2 Inférieur ou égal
 6 UA             -4            0 Inférieur ou égal
 7 B6             -5           -1 Inférieur ou égal
 8 EV             -3           -1 Inférieur ou égal
 9 B6             -3           -1 Inférieur ou égal
10 AA             -2           -3 Supérieur        
# ℹ 336,766 more rows</code></pre>
</div>
</div>
<p><code>group_by</code> peut aussi être utile avec <code>filter</code>, par exemple pour sélectionner <em>pour chaque mois</em> les vols avec un retard au départ plus élevé que le retard moyen ce mois-ci.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dep_delay <span class="sc">&gt;=</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 78,164 × 22
# Groups:   month [12]
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      611            600        11      945            931
 2  2013     1     1      623            610        13      920            915
 3  2013     1     1      632            608        24      740            728
 4  2013     1     1      732            645        47     1011            941
 5  2013     1     1      743            730        13     1107           1100
 6  2013     1     1      743            730        13     1059           1056
 7  2013     1     1      749            710        39      939            850
 8  2013     1     1      811            630       101     1047            830
 9  2013     1     1      826            715        71     1136           1045
10  2013     1     1      848           1835       853     1001           1950
# ℹ 78,154 more rows
# ℹ 14 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, duree_h &lt;dbl&gt;,
#   distance_km &lt;dbl&gt;, vitesse &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Attention&nbsp;:</strong> la clause <code>group_by</code> marche pour les verbes déjà vus précédemment, <em>sauf</em> pour <code>arrange</code>, qui par défaut trie la table sans tenir compte des groupes. Pour obtenir un tri par groupe, il faut lui ajouter l’argument <code>.by_group = TRUE</code>.</p>
</div>
</div>
<p>On peut voir la différence en comparant les deux résultats suivants&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(dep_delay))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 22
# Groups:   month [12]
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     9      641            900      1301     1242           1530
 2  2013     6    15     1432           1935      1137     1607           2120
 3  2013     1    10     1121           1635      1126     1239           1810
 4  2013     9    20     1139           1845      1014     1457           2210
 5  2013     7    22      845           1600      1005     1044           1815
 6  2013     4    10     1100           1900       960     1342           2211
 7  2013     3    17     2321            810       911      135           1020
 8  2013     6    27      959           1900       899     1236           2226
 9  2013     7    22     2257            759       898      121           1026
10  2013    12     5      756           1700       896     1058           2020
# ℹ 336,766 more rows
# ℹ 14 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, duree_h &lt;dbl&gt;,
#   distance_km &lt;dbl&gt;, vitesse &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(dep_delay), <span class="at">.by_group =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 22
# Groups:   month [12]
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     9      641            900      1301     1242           1530
 2  2013     1    10     1121           1635      1126     1239           1810
 3  2013     1     1      848           1835       853     1001           1950
 4  2013     1    13     1809            810       599     2054           1042
 5  2013     1    16     1622            800       502     1911           1054
 6  2013     1    23     1551            753       478     1812           1006
 7  2013     1    10     1525            900       385     1713           1039
 8  2013     1     1     2343           1724       379      314           1938
 9  2013     1     2     2131           1512       379     2340           1741
10  2013     1     7     2021           1415       366     2332           1724
# ℹ 336,766 more rows
# ℹ 14 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, duree_h &lt;dbl&gt;,
#   distance_km &lt;dbl&gt;, vitesse &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="summarise-et-count" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="summarise-et-count"><span class="header-section-number">1.4.2</span> <code>summarise</code> et <code>count</code></h3>
<p><code>summarise</code> permet d’agréger les lignes du tableau en effectuant une opération “résumée” sur une ou plusieurs colonnes. Par exemple, si on souhaite connaître les retards moyens au départ et à l’arrivée pour l’ensemble des vols du tableau <code>flights</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">retard_dep =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">retard_arr =</span> <span class="fu">mean</span>(arr_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  retard_dep retard_arr
       &lt;dbl&gt;      &lt;dbl&gt;
1       12.6       6.90</code></pre>
</div>
</div>
<p>Cette fonction est en général utilisée avec <code>group_by</code>, puisqu’elle permet du coup d’agréger et résumer les lignes du tableau groupe par groupe. Si on souhaite calculer le délai maximum, le délai minimum et le délai moyen au départ pour chaque mois, on pourra faire&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_delay =</span> <span class="fu">max</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_delay =</span> <span class="fu">min</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 4
   month max_delay min_delay mean_delay
   &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1     1      1301       -30      10.0 
 2     2       853       -33      10.8 
 3     3       911       -25      13.2 
 4     4       960       -21      13.9 
 5     5       878       -24      13.0 
 6     6      1137       -21      20.8 
 7     7      1005       -22      21.7 
 8     8       520       -26      12.6 
 9     9      1014       -24       6.72
10    10       702       -25       6.24
11    11       798       -32       5.44
12    12       896       -43      16.6 </code></pre>
</div>
</div>
<p><code>summarise</code> dispose d’un opérateur spécial, <code>n()</code>, qui retourne le nombre de lignes du groupe. Ainsi si on veut le nombre de vols par destination, on peut utiliser&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dest) <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">nb =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 105 × 2
   dest     nb
   &lt;chr&gt; &lt;int&gt;
 1 ABQ     254
 2 ACK     265
 3 ALB     439
 4 ANC       8
 5 ATL   17215
 6 AUS    2439
 7 AVL     275
 8 BDL     443
 9 BGR     375
10 BHM     297
# ℹ 95 more rows</code></pre>
</div>
</div>
<p><code>n()</code> peut aussi être utilisée avec <code>filter</code> et <code>mutate</code>.</p>
<p>À noter que quand on veut compter le nombre de lignes par groupe, il est plus simple d’utiliser directement la fonction <code>count</code>. Ainsi le code suivant est identique au précédent&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(dest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 105 × 2
   dest      n
   &lt;chr&gt; &lt;int&gt;
 1 ABQ     254
 2 ACK     265
 3 ALB     439
 4 ANC       8
 5 ATL   17215
 6 AUS    2439
 7 AVL     275
 8 BDL     443
 9 BGR     375
10 BHM     297
# ℹ 95 more rows</code></pre>
</div>
</div>
</section>
<section id="grouper-selon-plusieurs-variables" class="level3" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="grouper-selon-plusieurs-variables"><span class="header-section-number">1.4.3</span> Grouper selon plusieurs variables</h3>
<p>On peut grouper selon plusieurs variables à la fois, il suffit de les indiquer dans la clause du <code>group_by</code>. Le <em>pipeline</em> suivant calcule le retard moyen au départ pour chaque mois et pour chaque destination, et trie le résultat par retard décroissant&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month, dest) <span class="sc">%&gt;%</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">retard_moyen =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(retard_moyen))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'month'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,113 × 3
# Groups:   month [12]
   month dest  retard_moyen
   &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;
 1    12 BZN           75  
 2     7 TUL           72.6
 3     3 DSM           71.0
 4     7 CAE           69.4
 5    11 SBN           67.5
 6     7 BHM           64.6
 7     7 TYS           60.6
 8     6 BHM           57.2
 9     1 TUL           55.2
10     1 SAV           54.8
# ℹ 1,103 more rows</code></pre>
</div>
</div>
<p>On peut également utiliser <code>count</code> sur plusieurs variables. Les commandes suivantes comptent le nombre de vols pour chaque couple aéroport de départ / aéroport d’arrivée, et trie le résultat par nombre de vols décroissant. Ici la colonne qui contient le nombre de vols, créée par <code>count</code>, s’appelle <code>n</code> par défaut&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(origin, dest) <span class="sc">%&gt;%</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 224 × 3
   origin dest      n
   &lt;chr&gt;  &lt;chr&gt; &lt;int&gt;
 1 JFK    LAX   11262
 2 LGA    ATL   10263
 3 LGA    ORD    8857
 4 JFK    SFO    8204
 5 LGA    CLT    6168
 6 EWR    ORD    6100
 7 JFK    BOS    5898
 8 LGA    MIA    5781
 9 JFK    MCO    5464
10 EWR    BOS    5327
# ℹ 214 more rows</code></pre>
</div>
</div>
<p>On peut utiliser plusieurs opérations de groupage dans le même <em>pipeline</em>. Ainsi, si on souhaite déterminer le couple aéroport de départ / aéroport d’arrivée ayant le retard moyen au départ le plus élevé pour chaque mois de l’année, on devra procéder en deux étapes&nbsp;:</p>
<ul>
<li>d’abord grouper selon mois, aéroports d’origine et d’arrivée pour calculer le retard moyen</li>
<li>puis grouper uniquement selon le mois pour sélectionner le mois avec le retard moyen maximal.</li>
</ul>
<p>Au final, on obtient le code suivant&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month, origin, dest) <span class="sc">%&gt;%</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">retard_moyen =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(retard_moyen)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'month', 'origin'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 4
# Groups:   month [12]
   month origin dest  retard_moyen
   &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt;
 1     1 EWR    TUL           55.2
 2     2 EWR    DSM           48.6
 3     3 EWR    DSM           71.0
 4     4 EWR    OKC           47.0
 5     5 EWR    TYS           60.6
 6     6 EWR    TYS           68.2
 7     7 EWR    CAE           81.5
 8     8 LGA    GSO           50.1
 9     9 LGA    MSN           24.7
10    10 EWR    CAE           50.1
11    11 LGA    SBN           67.5
12    12 EWR    BZN           75  </code></pre>
</div>
</div>
</section>
<section id="dégroupage" class="level3" data-number="1.4.4">
<h3 data-number="1.4.4" class="anchored" data-anchor-id="dégroupage"><span class="header-section-number">1.4.4</span> Dégroupage</h3>
<p>Lorsqu’on effectue un <code>group_by</code> suivi d’un <code>summarise</code>, le tableau résultat est automatiquement dégroupé <em>de la dernière variable de regroupement</em>. Ainsi le tableau généré par le code suivant est seulement groupé par <code>month</code> et <code>origin</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month, origin, dest) <span class="sc">%&gt;%</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">retard_moyen =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'month', 'origin'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,313 × 4
# Groups:   month, origin [36]
   month origin dest  retard_moyen
   &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt;
 1     1 EWR    ALB          41.4 
 2     1 EWR    ATL           8.07
 3     1 EWR    AUS           6.67
 4     1 EWR    AVL          25.5 
 5     1 EWR    BDL          21.1 
 6     1 EWR    BNA          16.3 
 7     1 EWR    BOS           8.99
 8     1 EWR    BQN          12.3 
 9     1 EWR    BTV          20.5 
10     1 EWR    BUF          23.1 
# ℹ 2,303 more rows</code></pre>
</div>
</div>
<p><code>dplyr</code> nous le signale d’ailleurs via un message d’avertissement : <code>summarise() has grouped output by 'month', 'origin'</code>.</p>
<p>Ce dégroupage progressif peut permettre “d’enchaîner” les opérations groupées. Dans l’exemple suivant on calcule le retard moyen au départ par destination et on conserve les trois retards les plus importants <em>pour chaque mois</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month, dest) <span class="sc">%&gt;%</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">retard_moyen =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(retard_moyen, <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'month'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 36 × 3
# Groups:   month [12]
   month dest  retard_moyen
   &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;
 1     1 TUL           55.2
 2     1 SAV           54.8
 3     1 DSM           42.2
 4     2 DSM           48.6
 5     2 TUL           34.2
 6     2 GSP           32.4
 7     3 DSM           71.0
 8     3 PVD           47.5
 9     3 CAE           46.9
10     4 OKC           47.0
# ℹ 26 more rows</code></pre>
</div>
</div>
<p>On peut à tout moment “dégrouper” un tableau à l’aide de <code>ungroup</code>. C’est nécessaire, dans l’exemple précédent, si on veut seulement récupérer les trois retards les plus importants pour l’ensemble des couples mois / destination.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month, dest) <span class="sc">%&gt;%</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">retard_moyen =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(retard_moyen, <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'month'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  month dest  retard_moyen
  &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;
1    12 BZN           75  
2     7 TUL           72.6
3     3 DSM           71.0</code></pre>
</div>
</div>
<p>On peut aussi spécifier précisément le comportement de dégroupage de <code>summarise</code> en lui fournissant un argument supplémentaire <code>.groups</code> qui peut prendre notamment les valeurs suivantes&nbsp;:</p>
<ul>
<li><code>"drop_last"</code> : dégroupe seulement de la dernière variable de groupage</li>
<li><code>"drop"</code> : dégroupe totalement le tableau résultat (équivaut à l’application d’un <code>ungroup</code>)</li>
<li><code>"keep"</code> : conserve toutes les variables de groupage</li>
</ul>
<p>Ce concept de dégroupage successif peut être un peu déroutant de prime abord. Il est donc utile de faire attention aux avertissements affichés par ces opérations, et il ne faut pas hésiter à ajouter un <code>ungroup</code> en fin de pipeline si on sait qu’on ne souhaite pas utiliser les groupes encore existants par la suite.</p>
<p>À noter que la fonction <code>count</code>, de son côté, renvoie un tableau non groupé.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(month, dest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,113 × 3
   month dest      n
   &lt;int&gt; &lt;chr&gt; &lt;int&gt;
 1     1 ALB      64
 2     1 ATL    1396
 3     1 AUS     169
 4     1 AVL       2
 5     1 BDL      37
 6     1 BHM      25
 7     1 BNA     399
 8     1 BOS    1245
 9     1 BQN      93
10     1 BTV     223
# ℹ 1,103 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="autres-fonctions-utiles" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="autres-fonctions-utiles"><span class="header-section-number">1.5</span> Autres fonctions utiles</h2>
<p><code>dplyr</code> contient beaucoup d’autres fonctions utiles pour la manipulation de données.</p>
<section id="slice_sample" class="level3" data-number="1.5.1">
<h3 data-number="1.5.1" class="anchored" data-anchor-id="slice_sample"><span class="header-section-number">1.5.1</span> <code>slice_sample</code></h3>
<p>Ce verbe permet de sélectionner aléatoirement un nombre de lignes (avec l’argument <code>n</code>) ou une fraction des lignes (avec l’argument <code>prop</code>) d’un tableau.</p>
<p>Ainsi si on veut choisir 5 lignes au hasard dans le tableau <code>airports</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>airports <span class="sc">%&gt;%</span> <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 8
  faa   name                           lat    lon   alt    tz dst   tzone       
  &lt;chr&gt; &lt;chr&gt;                        &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;       
1 MER   Castle                        37.4 -121.    189    -8 A     America/Los…
2 LNK   Lincoln                       40.9  -96.8  1219    -6 A     America/Chi…
3 DAB   Daytona Beach Intl            29.2  -81.1    34    -5 A     America/New…
4 ARV   Lakeland                      45.9  -89.7  1629    -6 A     America/Chi…
5 HUT   Hutchinson Municipal Airport  38.1  -97.9  1543    -6 A     America/Chi…</code></pre>
</div>
</div>
<p>Si on veut tirer au hasard 10% des lignes de <code>flights</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33,677 × 22
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013    10    31     1127           1135        -8     1402           1341
 2  2013    12    16        2           2250        72      111           2356
 3  2013    12    27     1042           1030        12     1158           1155
 4  2013     5    30      727            722         5     1026           1053
 5  2013     6     4     1357           1358        -1     1644           1704
 6  2013     8    13      648            625        23      932            915
 7  2013     5    22     1328           1329        -1     1619           1618
 8  2013    12     4     1313           1259        14     1600           1614
 9  2013     8     3     1324           1145        99     1528           1340
10  2013     1     8      708            700         8      837            839
# ℹ 33,667 more rows
# ℹ 14 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, duree_h &lt;dbl&gt;,
#   distance_km &lt;dbl&gt;, vitesse &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Ces fonctions sont utiles notamment pour faire de “l’échantillonnage” en tirant au hasard un certain nombre d’observations du tableau.</p>
</section>
<section id="lead-et-lag" class="level3" data-number="1.5.2">
<h3 data-number="1.5.2" class="anchored" data-anchor-id="lead-et-lag"><span class="header-section-number">1.5.2</span> <code>lead</code> et <code>lag</code></h3>
<p><code>lead</code> et <code>lag</code> permettent de décaler les observations d’une variable d’un cran vers l’arrière (pour <code>lead</code>) ou vers l’avant (pour <code>lag</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lead</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  2  3  4  5 NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lag</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA  1  2  3  4</code></pre>
</div>
</div>
<p>Ceci peut être utile pour des données de type “séries temporelles”. Par exemple, on peut facilement calculer l’écart entre le retard au départ de chaque vol et celui du vol précédent&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">dep_delay_prev =</span> <span class="fu">lag</span>(dep_delay),</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">dep_delay_diff =</span> dep_delay <span class="sc">-</span> dep_delay_prev</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_delay_prev, dep_delay, dep_delay_diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 3
   dep_delay_prev dep_delay dep_delay_diff
            &lt;dbl&gt;     &lt;dbl&gt;          &lt;dbl&gt;
 1             NA         2             NA
 2              2         4              2
 3              4         2             -2
 4              2        -1             -3
 5             -1        -6             -5
 6             -6        -4              2
 7             -4        -5             -1
 8             -5        -3              2
 9             -3        -3              0
10             -3        -2              1
# ℹ 336,766 more rows</code></pre>
</div>
</div>
</section>
<section id="distinct-et-n_distinct" class="level3" data-number="1.5.3">
<h3 data-number="1.5.3" class="anchored" data-anchor-id="distinct-et-n_distinct"><span class="header-section-number">1.5.3</span> <code>distinct</code> et <code>n_distinct</code></h3>
<p><code>distinct</code> filtre les lignes du tableau pour ne conserver que les lignes distinctes, en supprimant toutes les lignes en double.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(day, month) <span class="sc">%&gt;%</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 2
     day month
   &lt;int&gt; &lt;int&gt;
 1     1     1
 2     2     1
 3     3     1
 4     4     1
 5     5     1
 6     6     1
 7     7     1
 8     8     1
 9     9     1
10    10     1
# ℹ 355 more rows</code></pre>
</div>
</div>
<p>On peut lui spécifier une liste de variables&nbsp;: dans ce cas, pour toutes les observations ayant des valeurs identiques pour les variables en question, <code>distinct</code> ne conservera que la première d’entre elles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(month, day)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 2
   month   day
   &lt;int&gt; &lt;int&gt;
 1     1     1
 2     1     2
 3     1     3
 4     1     4
 5     1     5
 6     1     6
 7     1     7
 8     1     8
 9     1     9
10     1    10
# ℹ 355 more rows</code></pre>
</div>
</div>
<p>L’option <code>.keep_all</code> permet, dans l’opération précédente, de conserver l’ensemble des colonnes du tableau&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(month, day, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 22
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     2       42           2359        43      518            442
 3  2013     1     3       32           2359        33      504            442
 4  2013     1     4       25           2359        26      505            442
 5  2013     1     5       14           2359        15      503            445
 6  2013     1     6       16           2359        17      451            442
 7  2013     1     7       49           2359        50      531            444
 8  2013     1     8      454            500        -6      625            648
 9  2013     1     9        2           2359         3      432            444
10  2013     1    10        3           2359         4      426            437
# ℹ 355 more rows
# ℹ 14 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, duree_h &lt;dbl&gt;,
#   distance_km &lt;dbl&gt;, vitesse &lt;dbl&gt;</code></pre>
</div>
</div>
<p>La fonction <code>n_distinct</code>, elle, renvoie le nombre de valeurs distinctes d’un vecteur. On peut notamment l’utiliser dans un <code>summarise</code>.</p>
<p>Dans l’exemple qui suit on calcule, pour les trois aéroports de départ de la table <code>flights</code> le nombre de valeurs distinctes de l’aéroport d’arrivée&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(origin) <span class="sc">%&gt;%</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_dest =</span> <span class="fu">n_distinct</span>(dest))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  origin n_dest
  &lt;chr&gt;   &lt;int&gt;
1 EWR        86
2 JFK        70
3 LGA        68</code></pre>
</div>
</div>
</section>
<section id="relocate" class="level3" data-number="1.5.4">
<h3 data-number="1.5.4" class="anchored" data-anchor-id="relocate"><span class="header-section-number">1.5.4</span> <code>relocate</code></h3>
<p><code>relocate</code> peut être utilisé pour réordonner les colonnes d’une table. Par défaut, si on lui passe un ou plusieurs noms de colonnes, <code>relocate</code> les place en début de tableau.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>airports <span class="sc">%&gt;%</span> <span class="fu">relocate</span>(lat, lon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,458 × 8
     lat    lon faa   name                             alt    tz dst   tzone    
   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    
 1  41.1  -80.6 04G   Lansdowne Airport               1044    -5 A     America/…
 2  32.5  -85.7 06A   Moton Field Municipal Airport    264    -6 A     America/…
 3  42.0  -88.1 06C   Schaumburg Regional              801    -6 A     America/…
 4  41.4  -74.4 06N   Randall Airport                  523    -5 A     America/…
 5  31.1  -81.4 09J   Jekyll Island Airport             11    -5 A     America/…
 6  36.4  -82.2 0A9   Elizabethton Municipal Airport  1593    -5 A     America/…
 7  41.5  -84.5 0G6   Williams County Airport          730    -5 A     America/…
 8  42.9  -76.8 0G7   Finger Lakes Regional Airport    492    -5 A     America/…
 9  39.8  -76.6 0P2   Shoestring Aviation Airfield    1000    -5 U     America/…
10  48.1 -123.  0S9   Jefferson County Intl            108    -8 A     America/…
# ℹ 1,448 more rows</code></pre>
</div>
</div>
<p>Les arguments supplémentaires <code>.before</code> et <code>.after</code> permettent de préciser à quel endroit déplacer la ou les colonnes indiquées.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>airports <span class="sc">%&gt;%</span> <span class="fu">relocate</span>(<span class="fu">starts_with</span>(<span class="st">'tz'</span>), <span class="at">.after =</span> name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,458 × 8
   faa   name                              tz tzone       lat    lon   alt dst  
   &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
 1 04G   Lansdowne Airport                 -5 America/…  41.1  -80.6  1044 A    
 2 06A   Moton Field Municipal Airport     -6 America/…  32.5  -85.7   264 A    
 3 06C   Schaumburg Regional               -6 America/…  42.0  -88.1   801 A    
 4 06N   Randall Airport                   -5 America/…  41.4  -74.4   523 A    
 5 09J   Jekyll Island Airport             -5 America/…  31.1  -81.4    11 A    
 6 0A9   Elizabethton Municipal Airport    -5 America/…  36.4  -82.2  1593 A    
 7 0G6   Williams County Airport           -5 America/…  41.5  -84.5   730 A    
 8 0G7   Finger Lakes Regional Airport     -5 America/…  42.9  -76.8   492 A    
 9 0P2   Shoestring Aviation Airfield      -5 America/…  39.8  -76.6  1000 U    
10 0S9   Jefferson County Intl             -8 America/…  48.1 -123.    108 A    
# ℹ 1,448 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="tables-multiples" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="tables-multiples"><span class="header-section-number">1.6</span> Tables multiples</h2>
<p>Le jeu de données <code>nycflights13</code> est un exemple de données réparties en plusieurs tables. Ici on en a trois&nbsp;: les informations sur les vols dans <code>flights</code>, celles sur les aéroports dans <code>airports</code> et celles sur les compagnies aériennes dans <code>airlines</code>.</p>
<p><code>dplyr</code> propose différentes fonctions permettant de travailler avec des données structurées de cette manière.</p>
<section id="concaténation-bind_rows-et-bind_cols" class="level3" data-number="1.6.1">
<h3 data-number="1.6.1" class="anchored" data-anchor-id="concaténation-bind_rows-et-bind_cols"><span class="header-section-number">1.6.1</span> Concaténation&nbsp;: <code>bind_rows</code> et <code>bind_cols</code></h3>
<p>Les fonctions <code>bind_rows</code> et <code>bind_cols</code> permettent d’ajouter des lignes (respectivement des colonnes) à une table à partir d’une ou plusieurs autres tables.</p>
<p>L’exemple suivant (certes très artificiel) montre l’utilisation de <code>bind_rows</code>. On commence par créer trois tableaux <code>t1</code>, <code>t2</code> et <code>t3</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> airports <span class="sc">%&gt;%</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(faa, name, lat, lon) <span class="sc">%&gt;%</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>t1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  faa   name                            lat   lon
  &lt;chr&gt; &lt;chr&gt;                         &lt;dbl&gt; &lt;dbl&gt;
1 04G   Lansdowne Airport              41.1 -80.6
2 06A   Moton Field Municipal Airport  32.5 -85.7</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> airports <span class="sc">%&gt;%</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(faa, name, lat, lon) <span class="sc">%&gt;%</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>t2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  faa   name                             lat   lon
  &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt; &lt;dbl&gt;
1 09J   Jekyll Island Airport           31.1 -81.4
2 0A9   Elizabethton Municipal Airport  36.4 -82.2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>t3 <span class="ot">&lt;-</span> airports <span class="sc">%&gt;%</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(faa, name) <span class="sc">%&gt;%</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">101</span>)</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>t3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  faa   name             
  &lt;chr&gt; &lt;chr&gt;            
1 ADW   Andrews Afb      
2 AET   Allakaket Airport</code></pre>
</div>
</div>
<p>On concaténe ensuite les trois tables avec <code>bind_rows</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(t1, t2, t3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  faa   name                             lat   lon
  &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt; &lt;dbl&gt;
1 04G   Lansdowne Airport               41.1 -80.6
2 06A   Moton Field Municipal Airport   32.5 -85.7
3 09J   Jekyll Island Airport           31.1 -81.4
4 0A9   Elizabethton Municipal Airport  36.4 -82.2
5 ADW   Andrews Afb                     NA    NA  
6 AET   Allakaket Airport               NA    NA  </code></pre>
</div>
</div>
<p>On remarquera que si des colonnes sont manquantes pour certaines tables, comme les colonnes <code>lat</code> et <code>lon</code> de <code>t3</code>, des <code>NA</code> sont automatiquement insérées.</p>
<p>Il peut être utile, quand on concatène des lignes, de garder une trace du tableau d’origine de chacune des lignes dans le tableau final. C’est possible grâce à l’argument <code>.id</code> de <code>bind_rows</code>. On passe à cet argument le nom d’une colonne qui contiendra l’indicateur d’origine des lignes&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(t1, t2, t3, <span class="at">.id =</span> <span class="st">"source"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  source faa   name                             lat   lon
  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt; &lt;dbl&gt;
1 1      04G   Lansdowne Airport               41.1 -80.6
2 1      06A   Moton Field Municipal Airport   32.5 -85.7
3 2      09J   Jekyll Island Airport           31.1 -81.4
4 2      0A9   Elizabethton Municipal Airport  36.4 -82.2
5 3      ADW   Andrews Afb                     NA    NA  
6 3      AET   Allakaket Airport               NA    NA  </code></pre>
</div>
</div>
<p>Par défaut la colonne <code>.id</code> ne contient qu’un nombre, différent pour chaque tableau. On peut lui spécifier des valeurs plus explicites en “nommant” les tables dans <code>bind_rows</code> de la manière suivante&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="at">table1 =</span> t1, <span class="at">table2 =</span> t2, <span class="at">table3 =</span> t3, <span class="at">.id =</span> <span class="st">"source"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  source faa   name                             lat   lon
  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt; &lt;dbl&gt;
1 table1 04G   Lansdowne Airport               41.1 -80.6
2 table1 06A   Moton Field Municipal Airport   32.5 -85.7
3 table2 09J   Jekyll Island Airport           31.1 -81.4
4 table2 0A9   Elizabethton Municipal Airport  36.4 -82.2
5 table3 ADW   Andrews Afb                     NA    NA  
6 table3 AET   Allakaket Airport               NA    NA  </code></pre>
</div>
</div>
<p><code>bind_cols</code> permet de concaténer des colonnes et fonctionne de manière similaire&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(dep_delay, dep_time)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(origin, dest)</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>t3 <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(arr_delay, arr_time)</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(t1, t2, t3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  dep_delay dep_time origin dest  arr_delay arr_time
      &lt;dbl&gt;    &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;    &lt;int&gt;
1         2      517 EWR    IAH          11      830
2         4      533 LGA    IAH          20      850
3         2      542 JFK    MIA          33      923
4        -1      544 JFK    BQN         -18     1004
5        -6      554 LGA    ATL         -25      812</code></pre>
</div>
</div>
<p>À noter que <code>bind_cols</code> associe les lignes uniquement <em>par position</em>. Les lignes des différents tableaux associés doivent donc correspondre (et leur nombre doit être identique). Pour associer des tables <em>par valeur</em>, on doit utiliser des jointures.</p>
</section>
<section id="jointures" class="level3" data-number="1.6.2">
<h3 data-number="1.6.2" class="anchored" data-anchor-id="jointures"><span class="header-section-number">1.6.2</span> Jointures</h3>
<section id="clés-implicites" class="level4" data-number="1.6.2.1">
<h4 data-number="1.6.2.1" class="anchored" data-anchor-id="clés-implicites"><span class="header-section-number">1.6.2.1</span> Clés implicites</h4>
<p>Très souvent, les données relatives à une analyse sont réparties dans plusieurs tables différentes. Dans notre exemple, on peut voir que la table <code>flights</code> contient le code de la compagnie aérienne du vol dans la variable <code>carrier</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">select</span>(carrier)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 1
   carrier
   &lt;chr&gt;  
 1 UA     
 2 UA     
 3 AA     
 4 B6     
 5 DL     
 6 UA     
 7 B6     
 8 EV     
 9 B6     
10 AA     
# ℹ 336,766 more rows</code></pre>
</div>
</div>
<p>Et que par ailleurs la table <code>airlines</code> contient une information supplémentaire relative à ces compagnies, à savoir le nom complet.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>airlines</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 2
   carrier name                       
   &lt;chr&gt;   &lt;chr&gt;                      
 1 9E      Endeavor Air Inc.          
 2 AA      American Airlines Inc.     
 3 AS      Alaska Airlines Inc.       
 4 B6      JetBlue Airways            
 5 DL      Delta Air Lines Inc.       
 6 EV      ExpressJet Airlines Inc.   
 7 F9      Frontier Airlines Inc.     
 8 FL      AirTran Airways Corporation
 9 HA      Hawaiian Airlines Inc.     
10 MQ      Envoy Air                  
11 OO      SkyWest Airlines Inc.      
12 UA      United Air Lines Inc.      
13 US      US Airways Inc.            
14 VX      Virgin America             
15 WN      Southwest Airlines Co.     
16 YV      Mesa Airlines Inc.         </code></pre>
</div>
</div>
<p>Il est donc naturel de vouloir associer les deux, ici pour ajouter les noms complets des compagnies à la table <code>flights</code>. Pour cela on va effectuer une <em>jointure</em>&nbsp;: les lignes d’une table seront associées à une autre en se basant non pas sur leur position, mais sur les valeurs d’une ou plusieurs colonnes. Ces colonnes sont appelées des <em>clés</em>.</p>
<p>Pour faire une jointure de ce type, on va utiliser la fonction <code>left_join</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(flights, airlines)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour faciliter la lecture, on va afficher seulement certaines colonnes du résultat&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(flights, airlines) <span class="sc">%&gt;%</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(month, day, carrier, name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(carrier)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 4
   month   day carrier name                    
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;                   
 1     1     1 UA      United Air Lines Inc.   
 2     1     1 UA      United Air Lines Inc.   
 3     1     1 AA      American Airlines Inc.  
 4     1     1 B6      JetBlue Airways         
 5     1     1 DL      Delta Air Lines Inc.    
 6     1     1 UA      United Air Lines Inc.   
 7     1     1 B6      JetBlue Airways         
 8     1     1 EV      ExpressJet Airlines Inc.
 9     1     1 B6      JetBlue Airways         
10     1     1 AA      American Airlines Inc.  
# ℹ 336,766 more rows</code></pre>
</div>
</div>
<p>On voit que la table résultat est bien la fusion des deux tables d’origine selon les valeurs des deux colonnes clés <code>carrier</code>. On est parti de la table <code>flights</code>, et pour chaque ligne de celle-ci on a ajouté les colonnes de <code>airlines</code> pour lesquelles la valeur de <code>carrier</code> est la même. On a donc bien une nouvelle colonne <code>name</code> dans notre table résultat, avec le nom complet de la compagnie aérienne.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>À noter qu’on peut tout à fait utiliser le <em>pipe</em> avec les fonctions de jointure&nbsp;:</p>
<p><code>flights %&gt;% left_join(airlines)</code>.</p>
</div>
</div>
<p>Nous sommes ici dans le cas le plus simple concernant les clés de jointure&nbsp;: les deux clés sont uniques et portent le même nom dans les deux tables. Par défaut, si on ne lui spécifie pas explicitement les clés, <code>dplyr</code> fusionne en utilisant l’ensemble des colonnes communes aux deux tables. On peut d’ailleurs voir dans cet exemple qu’un message a été affiché précisant que la jointure s’est bien faite sur la variable <code>carrier</code>.</p>
</section>
<section id="clés-explicites" class="level4" data-number="1.6.2.2">
<h4 data-number="1.6.2.2" class="anchored" data-anchor-id="clés-explicites"><span class="header-section-number">1.6.2.2</span> Clés explicites</h4>
<p>La table <code>airports</code>, contient des informations supplémentaires sur les aéroports&nbsp;: nom complet, altitude, position géographique, etc. Chaque aéroport est identifié par un code contenu dans la colonne <code>faa</code>.</p>
<p>Si on regarde la table <code>flights</code>, on voit que le code d’identification des aéroports apparaît à deux endroits différents&nbsp;: pour l’aéroport de départ dans la colonne <code>origin</code>, et pour celui d’arrivée dans la colonne <code>dest</code>. On a donc deux clés de jointure possibles, et qui portent un nom différent de la clé de <code>airports</code>.</p>
<p>On va commencer par fusionner les données concernant l’aéroport de départ. Pour simplifier l’affichage des résultats, on va se contenter d’un sous-ensemble des deux tables&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>flights_ex <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> <span class="fu">select</span>(month, day, origin, dest)</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>airports_ex <span class="ot">&lt;-</span> airports <span class="sc">%&gt;%</span> <span class="fu">select</span>(faa, alt, name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si on se contente d’un <code>left_join</code> comme à l’étape précédente, on obtient un message d’erreur car aucune colonne commune ne peut être identifiée comme clé de jointure&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>flights_ex <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(airports_ex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `left_join()`:
! `by` must be supplied when `x` and `y` have no common variables.
ℹ Use `cross_join()` to perform a cross-join.</code></pre>
</div>
</div>
<p>On doit donc spécifier explicitement les clés avec l’argument <code>by</code> de <code>left_join</code>. Ici la clé est nommée <code>origin</code> dans la première table, et <code>faa</code> dans la seconde. La syntaxe est donc la suivante&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>flights_ex <span class="sc">%&gt;%</span> </span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airports_ex, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"origin"</span> <span class="ot">=</span> <span class="st">"faa"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 6
   month   day origin dest    alt name               
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;              
 1     1     1 EWR    IAH      18 Newark Liberty Intl
 2     1     1 LGA    IAH      22 La Guardia         
 3     1     1 JFK    MIA      13 John F Kennedy Intl
 4     1     1 JFK    BQN      13 John F Kennedy Intl
 5     1     1 LGA    ATL      22 La Guardia         
 6     1     1 EWR    ORD      18 Newark Liberty Intl
 7     1     1 EWR    FLL      18 Newark Liberty Intl
 8     1     1 LGA    IAD      22 La Guardia         
 9     1     1 JFK    MCO      13 John F Kennedy Intl
10     1     1 LGA    ORD      22 La Guardia         
# ℹ 336,766 more rows</code></pre>
</div>
</div>
<p>On constate que les deux nouvelles colonnes <code>name</code> et <code>alt</code> contiennent bien les données correspondant à l’aéroport de départ.</p>
<p>On va stocker le résultat de cette jointure dans la table <code>flights_ex</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>flights_ex <span class="ot">&lt;-</span> flights_ex <span class="sc">%&gt;%</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airports_ex, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"origin"</span> <span class="ot">=</span> <span class="st">"faa"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Supposons qu’on souhaite maintenant fusionner à nouveau les informations de la table <code>airports</code>, mais cette fois pour les aéroports d’arrivée de notre nouvelle table <code>flights_ex</code>. Les deux clés sont donc désormais <code>dest</code> dans la première table, et <code>faa</code> dans la deuxième. La syntaxe est donc la suivante&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>flights_ex <span class="sc">%&gt;%</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airports_ex, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"dest"</span> <span class="ot">=</span> <span class="st">"faa"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 8
   month   day origin dest  alt.x name.x              alt.y name.y              
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;               
 1     1     1 EWR    IAH      18 Newark Liberty Intl    97 George Bush Interco…
 2     1     1 LGA    IAH      22 La Guardia             97 George Bush Interco…
 3     1     1 JFK    MIA      13 John F Kennedy Intl     8 Miami Intl          
 4     1     1 JFK    BQN      13 John F Kennedy Intl    NA &lt;NA&gt;                
 5     1     1 LGA    ATL      22 La Guardia           1026 Hartsfield Jackson …
 6     1     1 EWR    ORD      18 Newark Liberty Intl   668 Chicago Ohare Intl  
 7     1     1 EWR    FLL      18 Newark Liberty Intl     9 Fort Lauderdale Hol…
 8     1     1 LGA    IAD      22 La Guardia            313 Washington Dulles I…
 9     1     1 JFK    MCO      13 John F Kennedy Intl    96 Orlando Intl        
10     1     1 LGA    ORD      22 La Guardia            668 Chicago Ohare Intl  
# ℹ 336,766 more rows</code></pre>
</div>
</div>
<p>Cela fonctionne, les informations de l’aéroport d’arrivée ont bien été ajoutées, mais on constate que les colonnes ont été renommées. En effet, ici les deux tables fusionnées contenaient toutes les deux des colonnes <code>name</code> et <code>alt</code>. Comme on ne peut pas avoir deux colonnes avec le même nom dans un tableau, <code>dplyr</code> a renommé les colonnes de la première table en <code>name.x</code> et <code>alt.x</code>, et celles de la deuxième en <code>name.y</code> et <code>alt.y</code>.</p>
<p>C’est pratique, mais pas forcément très parlant. On pourrait renommer manuellement les colonnes avec <code>rename</code> avant de faire la jointure pour avoir des intitulés plus explicites, mais on peut aussi utiliser l’argument <code>suffix</code> de <code>left_join</code>, qui permet d’indiquer les suffixes à ajouter aux colonnes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>flights_ex <span class="sc">%&gt;%</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>    airports_ex,</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"dest"</span> <span class="ot">=</span> <span class="st">"faa"</span>),</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_depart"</span>, <span class="st">"_arrivee"</span>)</span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 8
   month   day origin dest  alt_depart name_depart      alt_arrivee name_arrivee
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;                  &lt;dbl&gt; &lt;chr&gt;       
 1     1     1 EWR    IAH           18 Newark Liberty …          97 George Bush…
 2     1     1 LGA    IAH           22 La Guardia                97 George Bush…
 3     1     1 JFK    MIA           13 John F Kennedy …           8 Miami Intl  
 4     1     1 JFK    BQN           13 John F Kennedy …          NA &lt;NA&gt;        
 5     1     1 LGA    ATL           22 La Guardia              1026 Hartsfield …
 6     1     1 EWR    ORD           18 Newark Liberty …         668 Chicago Oha…
 7     1     1 EWR    FLL           18 Newark Liberty …           9 Fort Lauder…
 8     1     1 LGA    IAD           22 La Guardia               313 Washington …
 9     1     1 JFK    MCO           13 John F Kennedy …          96 Orlando Intl
10     1     1 LGA    ORD           22 La Guardia               668 Chicago Oha…
# ℹ 336,766 more rows</code></pre>
</div>
</div>
<p>On obtient ainsi directement des noms de colonnes nettement plus clairs.</p>
</section>
</section>
<section id="types-de-jointures" class="level3" data-number="1.6.3">
<h3 data-number="1.6.3" class="anchored" data-anchor-id="types-de-jointures"><span class="header-section-number">1.6.3</span> Types de jointures</h3>
<p>Jusqu’à présent nous avons utilisé la fonction <code>left_join</code>, mais il existe plusieurs types de jointures.</p>
<p>Partons de deux tables d’exemple, <code>personnes</code> et <code>voitures</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>personnes <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">nom =</span> <span class="fu">c</span>(<span class="st">"Sylvie"</span>, <span class="st">"Sylvie"</span>, <span class="st">"Monique"</span>, <span class="st">"Gunter"</span>, <span class="st">"Rayan"</span>, <span class="st">"Rayan"</span>),</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">voiture =</span> <span class="fu">c</span>(<span class="st">"Twingo"</span>, <span class="st">"Ferrari"</span>, <span class="st">"Scenic"</span>, <span class="st">"Lada"</span>, <span class="st">"Twingo"</span>, <span class="st">"Clio"</span>)</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">nom</th>
<th style="text-align: left;">voiture</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Twingo</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Ferrari</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Monique</td>
<td style="text-align: left;">Scenic</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gunter</td>
<td style="text-align: left;">Lada</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Twingo</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Clio</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>voitures <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">voiture =</span> <span class="fu">c</span>(<span class="st">"Twingo"</span>, <span class="st">"Ferrari"</span>, <span class="st">"Clio"</span>, <span class="st">"Lada"</span>, <span class="st">"208"</span>),</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">vitesse =</span> <span class="fu">c</span>(<span class="st">"140"</span>, <span class="st">"280"</span>, <span class="st">"160"</span>, <span class="st">"85"</span>, <span class="st">"160"</span>)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">voiture</th>
<th style="text-align: left;">vitesse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ferrari</td>
<td style="text-align: left;">280</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Clio</td>
<td style="text-align: left;">160</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lada</td>
<td style="text-align: left;">85</td>
</tr>
<tr class="odd">
<td style="text-align: left;">208</td>
<td style="text-align: left;">160</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="left_join" class="level4" data-number="1.6.3.1">
<h4 data-number="1.6.3.1" class="anchored" data-anchor-id="left_join"><span class="header-section-number">1.6.3.1</span> left_join</h4>
<p>Si on fait un <code>left_join</code> de <code>voitures</code> sur <code>personnes</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>personnes <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(voitures)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(voiture)`</code></pre>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">nom</th>
<th style="text-align: left;">voiture</th>
<th style="text-align: left;">vitesse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Ferrari</td>
<td style="text-align: left;">280</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Monique</td>
<td style="text-align: left;">Scenic</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gunter</td>
<td style="text-align: left;">Lada</td>
<td style="text-align: left;">85</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Clio</td>
<td style="text-align: left;">160</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On voit que chaque ligne de <code>personnes</code> est bien présente, et qu’on lui a ajouté une ligne de <code>voitures</code> correspondante si elle existe. Dans le cas du <code>Scenic</code>, il n’y a avait pas de ligne dans <code>voitures</code>, donc <code>vitesse</code> a été mise à <code>NA</code>. Dans le cas de <code>208</code>, présente dans <code>voitures</code> mais pas dans <code>personnes</code>, la ligne n’apparaît pas.</p>
<p>Si on fait un <code>left_join</code> cette fois de <code>personnes</code> sur <code>voitures</code>, c’est l’inverse&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>voitures <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(personnes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(voiture)`</code></pre>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">voiture</th>
<th style="text-align: left;">vitesse</th>
<th style="text-align: left;">nom</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
<td style="text-align: left;">Sylvie</td>
</tr>
<tr class="even">
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
<td style="text-align: left;">Rayan</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ferrari</td>
<td style="text-align: left;">280</td>
<td style="text-align: left;">Sylvie</td>
</tr>
<tr class="even">
<td style="text-align: left;">Clio</td>
<td style="text-align: left;">160</td>
<td style="text-align: left;">Rayan</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lada</td>
<td style="text-align: left;">85</td>
<td style="text-align: left;">Gunter</td>
</tr>
<tr class="even">
<td style="text-align: left;">208</td>
<td style="text-align: left;">160</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>La ligne <code>208</code> est là, mais <code>nom</code> est à <code>NA</code>. Par contre <code>Monique</code> est absente. Et on remarquera que la ligne <code>Twingo</code>, présente deux fois dans <code>personnes</code>, a été dupliquée pour être associée aux deux lignes de données de <code>Sylvie</code> et <code>Rayan</code>.</p>
<p>En résumé, quand on fait un <code>left_join(x, y)</code>, toutes les lignes de <code>x</code> sont présentes, et dupliquées si nécessaire quand elles apparaissent plusieurs fois dans <code>y</code>. Les lignes de <code>y</code> non présentes dans <code>x</code> disparaissent. Les lignes de <code>x</code> non présentes dans <code>y</code> se voient attribuer des <code>NA</code> pour les nouvelles colonnes.</p>
<p>Intuitivement, on pourrait considérer que <code>left_join(x, y)</code> signifie “ramener l’information de la table <code>y</code> sur la table <code>x</code>”.</p>
<p>En général, <code>left_join</code> sera le type de jointures le plus fréquemment utilisé.</p>
</section>
<section id="right_join" class="level4" data-number="1.6.3.2">
<h4 data-number="1.6.3.2" class="anchored" data-anchor-id="right_join"><span class="header-section-number">1.6.3.2</span> right_join</h4>
<p>La jointure <code>right_join</code> est l’exacte symétrique de <code>left_join</code>, c’est-à dire que <code>right_join(x, y)</code> est équivalent à <code>left_join(y, x)</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>personnes <span class="sc">%&gt;%</span> <span class="fu">right_join</span>(voitures)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(voiture)`</code></pre>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">nom</th>
<th style="text-align: left;">voiture</th>
<th style="text-align: left;">vitesse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Ferrari</td>
<td style="text-align: left;">280</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Gunter</td>
<td style="text-align: left;">Lada</td>
<td style="text-align: left;">85</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Clio</td>
<td style="text-align: left;">160</td>
</tr>
<tr class="even">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">208</td>
<td style="text-align: left;">160</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="inner_join" class="level4" data-number="1.6.3.3">
<h4 data-number="1.6.3.3" class="anchored" data-anchor-id="inner_join"><span class="header-section-number">1.6.3.3</span> inner_join</h4>
<p>Dans le cas de <code>inner_join(x, y)</code>, seules les lignes présentes à la fois dans <code>x</code> et <code>y</code> sont conservées (et si nécessaire dupliquées) dans la table résultat&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>personnes <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(voitures)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(voiture)`</code></pre>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">nom</th>
<th style="text-align: left;">voiture</th>
<th style="text-align: left;">vitesse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Ferrari</td>
<td style="text-align: left;">280</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Gunter</td>
<td style="text-align: left;">Lada</td>
<td style="text-align: left;">85</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Clio</td>
<td style="text-align: left;">160</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Ici la ligne <code>208</code> est absente, ainsi que la ligne <code>Monique</code>, qui dans le cas d’un <code>left_join</code> avait été conservée et s’était vue attribuer une <code>vitesse</code> à <code>NA</code>.</p>
</section>
<section id="full_join" class="level4" data-number="1.6.3.4">
<h4 data-number="1.6.3.4" class="anchored" data-anchor-id="full_join"><span class="header-section-number">1.6.3.4</span> full_join</h4>
<p>Dans le cas de <code>full_join(x, y)</code>, toutes les lignes de <code>x</code> et toutes les lignes de <code>y</code> sont conservées (avec des <code>NA</code> ajoutés si nécessaire) même si elles sont absentes de l’autre table&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>personnes <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(voitures)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(voiture)`</code></pre>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">nom</th>
<th style="text-align: left;">voiture</th>
<th style="text-align: left;">vitesse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Ferrari</td>
<td style="text-align: left;">280</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Monique</td>
<td style="text-align: left;">Scenic</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gunter</td>
<td style="text-align: left;">Lada</td>
<td style="text-align: left;">85</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Clio</td>
<td style="text-align: left;">160</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">208</td>
<td style="text-align: left;">160</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
</section>
<section id="ressources" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="ressources"><span class="header-section-number">1.7</span> Ressources</h2>
<p>Le livre <em>R for data science</em>, librement accessible en ligne, contient plusieurs chapitres très complets sur la manipulation des données, notamment&nbsp;:</p>
<ul>
<li><a href="http://r4ds.had.co.nz/transform.html">Data transformation</a> pour les manipulations</li>
<li><a href="http://r4ds.had.co.nz/relational-data.html">Relational data</a> pour les tables multiples</li>
</ul>
<p>Le <a href="http://dplyr.tidyverse.org/">site de l’extension</a> comprend une <a href="http://dplyr.tidyverse.org/reference/index.html">liste des fonctions</a> et les pages d’aide associées, mais aussi une <a href="http://dplyr.tidyverse.org/articles/dplyr.html">introduction</a> au package et plusieurs articles dont un spécifiquement sur les <a href="http://dplyr.tidyverse.org/articles/two-table.html">jointures</a>.</p>
<p>Enfin, une “antisèche” très synthétique est également accessible depuis RStudio, en allant dans le menu <em>Help</em> puis <em>Cheatsheets</em> et <em>Data Transformation with dplyr</em>.</p>
</section>
<section id="exercices" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="exercices"><span class="header-section-number">1.8</span> Exercices</h2>
<p>On commence par charger les extensions et les données nécessaires.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(flights)</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(airports)</span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(airlines)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="les-verbes-de-base-de-dplyr" class="level3" data-number="1.8.1">
<h3 data-number="1.8.1" class="anchored" data-anchor-id="les-verbes-de-base-de-dplyr"><span class="header-section-number">1.8.1</span> Les verbes de base de <code>dplyr</code></h3>
<p><strong>Exercice 1.1</strong></p>
<p>Sélectionner la dixième ligne du tableau des aéroports (<code>airports</code>).</p>
<p>Sélectionner les 5 premières lignes de la table <code>airlines</code>.</p>
<p>Sélectionner l’aéroport avec l’altitude la plus basse.</p>
<p><strong>Exercice 1.2</strong></p>
<p>Sélectionnez les vols du mois de juillet (variable <code>month</code>).</p>
<p>Sélectionnez les vols avec un retard à l’arrivée (variable <code>arr_delay</code>) compris entre 5 et 15 minutes.</p>
<p>Sélectionnez les vols des compagnies Delta, United et American (codes <code>DL</code>, <code>UA</code> et <code>AA</code> de la variable <code>carrier</code>).</p>
<p><strong>Exercice 1.3</strong></p>
<p>Triez la table <code>flights</code> par retard au départ décroissant.</p>
<p><strong>Exercice 1.4</strong></p>
<p>Sélectionnez les colonnes <code>name</code>, <code>lat</code> et <code>lon</code> de la table <code>airports</code></p>
<p>Sélectionnez toutes les colonnes de la table <code>airports</code> sauf les colonnes <code>tz</code> et <code>tzone</code></p>
<p>Sélectionnez toutes les colonnes de la table <code>flights</code> dont les noms se terminent par “delay”.</p>
<p>Dans la table <code>airports</code>, renommez la colonne <code>alt</code> en <code>altitude</code> et la colonne <code>tzone</code> en <code>fuseau_horaire</code>.</p>
<p><strong>Exercice 1.5</strong></p>
<p>Dans la table <code>airports</code>, la colonne <code>alt</code> contient l’altitude de l’aéroport en pieds. Créer une nouvelle variable <code>alt_m</code> contenant l’altitude en mètres (on convertit des pieds en mètres en les divisant par 3.2808). Sélectionner dans la table obtenue uniquement les deux colonnes <code>alt</code> et <code>alt_m</code>.</p>
</section>
<section id="enchaîner-des-opérations" class="level3" data-number="1.8.2">
<h3 data-number="1.8.2" class="anchored" data-anchor-id="enchaîner-des-opérations"><span class="header-section-number">1.8.2</span> Enchaîner des opérations</h3>
<p><strong>Exercice 2.1</strong></p>
<p>Réécrire le code de l’exercice précédent en utilisant le <em>pipe</em> <code>%&gt;%</code>.</p>
<p><strong>Exercice 2.2</strong></p>
<p>En utilisant le <em>pipe</em>, sélectionnez les vols à destination de San Francico (code <code>SFO</code> de la variable <code>dest</code>) et triez-les selon le retard au départ décroissant (variable <code>dep_delay</code>).</p>
<p><strong>Exercice 2.3</strong></p>
<p>Sélectionnez les vols des mois de septembre et octobre, conservez les colonnes <code>dest</code> et <code>dep_delay</code>, créez une nouvelle variable <code>retard_h</code> contenant le retard au départ en heures, et conservez uniquement les 5 lignes avec les plus grandes valeurs de <code>retard_h</code>.</p>
</section>
<section id="group_by-et-summarise" class="level3" data-number="1.8.3">
<h3 data-number="1.8.3" class="anchored" data-anchor-id="group_by-et-summarise"><span class="header-section-number">1.8.3</span> <code>group_by</code> et <code>summarise</code></h3>
<p><strong>Exercice 3.1</strong></p>
<p>Affichez le nombre de vols par mois.</p>
<p>Triez la table résultat selon le nombre de vols croissant.</p>
<p><strong>Exercice 3.2</strong></p>
<p>Calculer la distance moyenne des vols selon l’aéroport de départ (variable <code>origin</code>).</p>
<p><strong>Exercice 3.3</strong></p>
<p>Calculer le nombre de vols à destination de Los Angeles (code <code>LAX</code>) pour chaque mois de l’année.</p>
<p><strong>Exercice 3.4</strong></p>
<p>Calculer le nombre de vols selon le mois et la destination.</p>
<p>Ne conserver, pour chaque mois, que la destination avec le nombre maximal de vols.</p>
<p><strong>Exercice 3.5</strong></p>
<p>Calculer le nombre de vols selon le mois. Ajouter une colonne comportant le pourcentage de vols annuels réalisés par mois.</p>
<p><strong>Exercice 3.6</strong></p>
<p>Calculer, pour chaque aéroport de départ et de destination, la durée moyenne des vols (variable air_time). Pour chaque aéroport de départ, ne conserver que la destination avec la durée moyenne la plus longue.</p>
</section>
<section id="jointures-1" class="level3" data-number="1.8.4">
<h3 data-number="1.8.4" class="anchored" data-anchor-id="jointures-1"><span class="header-section-number">1.8.4</span> Jointures</h3>
<p><strong>Exercice 4.1</strong></p>
<p>Faire la jointure de la table <code>airlines</code> sur la table <code>flights</code> à l’aide de <code>left_join</code>.</p>
<p><strong>Exercice 4.2</strong></p>
<p>À partir de la table résultat de l’exercice précédent, calculer le retard moyen au départ pour chaque compagnie, et trier selon ce retard décroissant.</p>
<p><strong>Exercice 4.3</strong></p>
<p>Faire la jointure de la table <code>airports</code> sur la table <code>flights</code> en utilisant comme clé le code de l’aéroport de destination.</p>
<p>À partir de cette table, afficher pour chaque mois le nom de l’aéroport de destination ayant eu le plus petit nombre de vol.</p>
<p><strong>Exercice 4.4</strong></p>
<p>Créer une table indiquant, pour chaque vol, uniquement le nom de l’aéroport de départ et celui de l’aéroport d’arrivée.</p>


</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>À noter que cette opération est un peu plus “fragile” que les autres, car si l’ordre des colonnes change elle peut renvoyer un résultat différent.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Il est également possible de renommer des colonnes directement avec <code>select</code>, avec la même syntaxe que pour <code>rename</code>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Le <em>pipe</em> a été introduit à l’origine par l’extension <code>magrittr</code>, et repris par <code>dplyr</code><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>