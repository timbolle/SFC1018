<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SFC1018 - Traitement de données avec R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">SFC1018</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#le-tidyverse" id="toc-le-tidyverse" class="nav-link active" data-scroll-target="#le-tidyverse"><span class="header-section-number">1</span> Le tidyverse</a>
  <ul>
  <li><a href="#installation" id="toc-installation" class="nav-link" data-scroll-target="#installation"><span class="header-section-number">1.1</span> Installation</a></li>
  </ul></li>
  <li><a href="#sec-import" id="toc-sec-import" class="nav-link" data-scroll-target="#sec-import"><span class="header-section-number">2</span> Importer et exporter des données</a>
  <ul>
  <li><a href="#import-de-fichiers-textes" id="toc-import-de-fichiers-textes" class="nav-link" data-scroll-target="#import-de-fichiers-textes"><span class="header-section-number">2.1</span> Import de fichiers textes</a></li>
  <li><a href="#import-depuis-un-fichier-excel" id="toc-import-depuis-un-fichier-excel" class="nav-link" data-scroll-target="#import-depuis-un-fichier-excel"><span class="header-section-number">2.2</span> Import depuis un fichier Excel</a></li>
  <li><a href="#exercice-1" id="toc-exercice-1" class="nav-link" data-scroll-target="#exercice-1"><span class="header-section-number">2.3</span> Exercice 1</a></li>
  </ul></li>
  <li><a href="#les-tableaux-dans-r" id="toc-les-tableaux-dans-r" class="nav-link" data-scroll-target="#les-tableaux-dans-r"><span class="header-section-number">3</span> Les tableaux dans R</a></li>
  <li><a href="#sec-vectorfactor" id="toc-sec-vectorfactor" class="nav-link" data-scroll-target="#sec-vectorfactor"><span class="header-section-number">4</span> Recoder des variables</a>
  <ul>
  <li><a href="#sec-vecteurs" id="toc-sec-vecteurs" class="nav-link" data-scroll-target="#sec-vecteurs"><span class="header-section-number">4.1</span> Rappel sur les variables et les vecteurs</a></li>
  <li><a href="#sec-tests" id="toc-sec-tests" class="nav-link" data-scroll-target="#sec-tests"><span class="header-section-number">4.2</span> Tests et comparaison</a></li>
  <li><a href="#sec-recoder-une-variable-qualitative" id="toc-sec-recoder-une-variable-qualitative" class="nav-link" data-scroll-target="#sec-recoder-une-variable-qualitative"><span class="header-section-number">4.3</span> Recoder une variable qualitative</a>
  <ul class="collapse">
  <li><a href="#sec-facteurs" id="toc-sec-facteurs" class="nav-link" data-scroll-target="#sec-facteurs"><span class="header-section-number">4.3.1</span> Facteurs et <code>forcats</code></a></li>
  <li><a href="#sec-recode" id="toc-sec-recode" class="nav-link" data-scroll-target="#sec-recode"><span class="header-section-number">4.3.2</span> Modifier les modalités d’une variable qualitative</a></li>
  <li><a href="#ordonner-les-modalités-dune-variable-qualitative" id="toc-ordonner-les-modalités-dune-variable-qualitative" class="nav-link" data-scroll-target="#ordonner-les-modalités-dune-variable-qualitative"><span class="header-section-number">4.3.3</span> Ordonner les modalités d’une variable qualitative</a></li>
  <li><a href="#sec-if-else" id="toc-sec-if-else" class="nav-link" data-scroll-target="#sec-if-else"><span class="header-section-number">4.3.4</span> <code>ifelse</code></a></li>
  <li><a href="#case_when" id="toc-case_when" class="nav-link" data-scroll-target="#case_when"><span class="header-section-number">4.3.5</span> <code>case_when</code></a></li>
  </ul></li>
  <li><a href="#découper-une-variable-numérique-en-classes" id="toc-découper-une-variable-numérique-en-classes" class="nav-link" data-scroll-target="#découper-une-variable-numérique-en-classes"><span class="header-section-number">4.4</span> Découper une variable numérique en classes</a></li>
  </ul></li>
  <li><a href="#manipuler-des-chaines-de-caractères" id="toc-manipuler-des-chaines-de-caractères" class="nav-link" data-scroll-target="#manipuler-des-chaines-de-caractères"><span class="header-section-number">5</span> Manipuler des chaines de caractères</a>
  <ul>
  <li><a href="#sec-concat" id="toc-sec-concat" class="nav-link" data-scroll-target="#sec-concat"><span class="header-section-number">5.1</span> Concaténer des chaînes</a></li>
  <li><a href="#convertir-en-majuscules-minuscules" id="toc-convertir-en-majuscules-minuscules" class="nav-link" data-scroll-target="#convertir-en-majuscules-minuscules"><span class="header-section-number">5.2</span> Convertir en majuscules / minuscules</a></li>
  <li><a href="#découper-des-chaînes" id="toc-découper-des-chaînes" class="nav-link" data-scroll-target="#découper-des-chaînes"><span class="header-section-number">5.3</span> Découper des chaînes</a></li>
  <li><a href="#extraire-des-sous-chaînes-par-position" id="toc-extraire-des-sous-chaînes-par-position" class="nav-link" data-scroll-target="#extraire-des-sous-chaînes-par-position"><span class="header-section-number">5.4</span> Extraire des sous-chaînes par position</a></li>
  <li><a href="#sec-str-detect" id="toc-sec-str-detect" class="nav-link" data-scroll-target="#sec-str-detect"><span class="header-section-number">5.5</span> Détecter des motifs</a></li>
  <li><a href="#extraire-des-motifs" id="toc-extraire-des-motifs" class="nav-link" data-scroll-target="#extraire-des-motifs"><span class="header-section-number">5.6</span> Extraire des motifs</a></li>
  <li><a href="#remplacer-des-motifs" id="toc-remplacer-des-motifs" class="nav-link" data-scroll-target="#remplacer-des-motifs"><span class="header-section-number">5.7</span> Remplacer des motifs</a></li>
  <li><a href="#ressources" id="toc-ressources" class="nav-link" data-scroll-target="#ressources"><span class="header-section-number">5.8</span> Ressources</a></li>
  </ul></li>
  <li><a href="#exercices" id="toc-exercices" class="nav-link" data-scroll-target="#exercices"><span class="header-section-number">6</span> Exercices</a>
  <ul>
  <li><a href="#exercice-2" id="toc-exercice-2" class="nav-link" data-scroll-target="#exercice-2"><span class="header-section-number">6.1</span> Exercice 2</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Traitement de données avec R</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="le-tidyverse" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Le tidyverse</h1>
<p>Le terme <em>tidyverse</em> est une contraction de <em>tidy</em> (qu’on pourrait traduire par “bien rangé”) et de <em>universe</em>. Il s’agit en fait d’une collection d’extensions conçues pour travailler ensemble et basées sur une philosophie commune.</p>
<p>Elles abordent un très grand nombre d’opérations courantes dans R (la liste n’est pas exhaustive)&nbsp;:</p>
<ul>
<li>visualisation</li>
<li>manipulation des tableaux de données</li>
<li>import/export de données</li>
<li>manipulation de variables</li>
<li>extraction de données du Web</li>
<li>programmation</li>
</ul>
<p>Un des objectifs de ces extensions est de fournir des fonctions avec une syntaxe cohérente, qui fonctionnent bien ensemble, et qui retournent des résultats prévisibles. Elles sont en grande partie issues du travail d’<a href="http://hadley.nz/">Hadley Wickham</a>, qui travaille désormais pour <a href="https://www.rstudio.com">RStudio</a>.</p>
<section id="installation" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="installation"><span class="header-section-number">1.1</span> Installation</h2>
<p><code>tidyverse</code> est également le nom d’une extension qu’on peut installer de manière classique, soit via le bouton <em>Install</em> de l’onglet <em>Packages</em> de RStudio, soit en utilisant la commande&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Normalement vous devriez déjà avoir fait cette installation lors de la partie précédente.</p>
</div>
</div>
<p>Cette commande va en fait installer plusieurs extensions qui constituent le “coeur” du <em>tidyverse</em>, à savoir&nbsp;:</p>
<ul>
<li><code>ggplot2</code> (visualisation)</li>
<li><code>dplyr</code> (manipulation des données)</li>
<li><code>tidyr</code> (remise en forme des données)</li>
<li><code>purrr</code> (programmation)</li>
<li><code>readr</code> (importation de données)</li>
<li><code>tibble</code> (tableaux de données)</li>
<li><code>forcats</code> (variables qualitatives)</li>
<li><code>stringr</code> (chaînes de caractères)</li>
<li><code>lubridate</code> (manipulation de dates)</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/logos/core_packages.png" class="img-fluid figure-img"></p>
<figcaption>Packages de l’extension tidyverse</figcaption>
</figure>
</div>
<p>De la même manière, charger l’extension avec&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.0     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
<p>Chargera l’ensemble des extensions précédentes. Elles peuvent également être chargées indépendamment.</p>
<p>Il existe d’autres extensions qui font partie du <em>tidyverse</em> mais qui doivent être chargées explicitement, comme par exemple <code>readxl</code> (pour l’importation de données depuis des fichiers Excel). La liste complète se trouve sur <a href="https://www.tidyverse.org/packages/">le site officiel du <em>tidyverse</em></a>.</p>
</section>
</section>
<section id="sec-import" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Importer et exporter des données</h1>
<p>R n’est pas prévu pour la saisie de données, mais il bénéficie de nombreuses fonctions et packages permettant l’import de données depuis un grand nombre de formats, notamment les fichier de type CSV et les fichiers Excel.</p>
<p>Il est très vivement conseillé de travailler avec les projets de RStudio pour faciliter l’accès aux fichiers et pouvoir regrouper l’ensemble des éléments d’une analyse dans un dossier.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Les projets permettent notamment de ne pas avoir à spécifier un chemin complet vers un fichier (sous Windows, quelque chose du genre <code>C:\\Users\\tim\\Documents\\projet\\data\\donnees.xlsx</code>) mais un chemin relatif au dossier du projet (juste <code>donnees.xls</code> si le fichier se trouve à la racine du projet, <code>data/donnees.xls</code> s’il se trouve dans un sous-dossier <code>data</code>, etc.)</p>
</div>
</div>
<section id="import-de-fichiers-textes" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="import-de-fichiers-textes"><span class="header-section-number">2.1</span> Import de fichiers textes</h2>
<p>L’extension <code>readr</code>, qui fait partie du <em>tidyverse</em>, permet l’importation de fichiers texte, notamment au format CSV (<em>Comma separated values</em>), format standard pour l’échange de données tabulaires entre logiciels.</p>
<p>Cette extension fait partie du “coeur” du <em>tidyverse</em>, elle est donc automatiquement chargée avec&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si votre fichier CSV suit un format CSV standard (c’est le cas s’il a été exporté depuis LibreOffice par exemple), avec des champs séparés par des virgules, vous pouvez utiliser la fonction <code>read_csv</code> en lui passant en argument le nom du fichier&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"fichier.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ici, nous avons indiquer un nom de fichier générique qui n’est pas fournit. Ici, le fichier StarWars_Characters.csv a été placé dans un dossier <em>data</em> qui se trouve dans le même dossier que votre script R !</p>
</div>
</div>
<p>Si votre fichier vient d’Excel, avec des valeurs séparées par des points virgule, utilisez la fonction <code>read_csv2</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="st">"fichier.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dans la même famille de fonction, <code>read_tsv</code> permet d’importer des fichiers dont les valeurs sont séparées par des tabulations, et <code>read_delim</code> des fichiers délimités par un séparateur indiqué en argument.</p>
<p>Chaque fonction dispose de plusieurs arguments, parmi lesquels&nbsp;:</p>
<ul>
<li><code>col_names</code> indique si la première ligne contient le nom des colonnes (<code>TRUE</code> par défaut)</li>
<li><code>col_types</code> permet de spécifier manuellement le type des colonnes si <code>readr</code> ne les identifie pas correctement</li>
<li><code>na</code> est un vecteur de chaînes de caractères indiquant les valeurs devant être considérées comme manquantes. Ce vecteur vaut <code>c("", "NA")</code> par défaut</li>
</ul>
<p>Il peut arriver, notamment sous Windows, que l’encodage des caractères accentués ne soit pas correct au moment de l’importation. On peut alors spécifier manuellement l’encodage du fichier importé à l’aide de l’option <code>locale</code>. Par exemple, si l’on est sous Mac ou Linux et que le fichier a été créé sous Windows, il est possible qu’il soit encodé au format iso-8859-1. On peut alors l’importer avec&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"fichier.csv"</span>, <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">"ISO-8859-1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>À l’inverse, si vous importez un fichier sous Windows et que les accents ne sont pas affichés correctement, il est sans doute encodé en UTF-8&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"fichier.csv"</span>, <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">"UTF-8"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour plus d’informations sur ces fonctions, voir <a href="http://readr.tidyverse.org/">le site de l’extension readr</a>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>À noter que si vous souhaitez importer des fichiers textes très volumineux le plus rapidement possible, la fonction <code>fread</code> de l’extension <code>data.table</code> est plus rapide que <code>read_csv</code>.</p>
</div>
</div>
</section>
<section id="import-depuis-un-fichier-excel" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="import-depuis-un-fichier-excel"><span class="header-section-number">2.2</span> Import depuis un fichier Excel</h2>
<p>L’extension <code>readxl</code>, qui fait également partie du <em>tidyverse</em>, permet d’importer des données directement depuis un fichier au format <code>xls</code>ou <code>xlsx</code>.</p>
<p>Elle ne fait pas partie du “coeur” du <em>tidyverse</em>, il faut donc la charger explicitement avec&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut alors utiliser la fonction <code>read_excel</code> en lui spécifiant le nom du fichier&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"fichier.xls"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Il est possible de spécifier la feuille et la plage de cellules que l’on souhaite importer avec les arguments <code>sheet</code> et <code>range</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"fichier.xls"</span>, <span class="at">sheet =</span> <span class="st">"Feuille2"</span>, <span class="at">range =</span> <span class="st">"C1:F124"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour plus d’informations, voir <a href="http://readxl.tidyverse.org/">le site de l’extension <code>readxl</code></a>.</p>
</section>
<section id="exercice-1" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="exercice-1"><span class="header-section-number">2.3</span> Exercice 1</h2>
<p>Importez les données présentes dans les fichiers <em>StarWars_characters.csv</em> et celles présentes dans la feuille <em>character</em> du fichier <em>StarWars.xlsx</em></p>
</section>
</section>
<section id="les-tableaux-dans-r" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Les tableaux dans R</h1>
<p>Par défaut, les tableaux dans R sont appelés de <em>Data Frames</em> (<code>data.frame</code>), dans lesquels on peut spécifier des lignes et des colonnes. La pluspart des packages pour la science des données travaillent avec des data frames. Par exemple, les jeux de données présents par défaut dans R sont des <em>data frames</em>, ici</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.data.frame</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Une autre particularité du <em>tidyverse</em> est que ces packages travaillent avec des tableaux de données au format <em>tibble</em>, qui est une évolution plus moderne du classique <em>data frame</em> du R de base. Ce format est fourni et géré par l’extension du même nom (<code>tibble</code>), qui fait partie du coeur du <em>tidyverse</em>. La plupart des fonctions des extensions du <em>tidyverse</em> acceptent des <em>data frames</em> en entrée, mais retournent un objet de classe <code>tibble</code>.</p>
<p>Contrairement aux <em>data frames</em>, les <em>tibbles</em>&nbsp;:</p>
<ul>
<li>n’ont pas de noms de lignes (<em>rownames</em>)</li>
<li>autorisent des noms de colonnes invalides pour les <em>data frames</em> (espaces, caractères spéciaux, nombres…)<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
<li>s’affichent plus intelligemment que les <em>data frames</em>&nbsp;: seules les premières lignes sont affichées, ainsi que quelques informations supplémentaires utiles (dimensions, types des colonnes…)</li>
<li>ne font pas de <em>partial matching</em> sur les noms de colonnes<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></li>
<li>affichent un avertissement si on essaie d’accéder à une colonne qui n’existe pas</li>
</ul>
<p>Pour autant, les tibbles restent compatibles avec les <em>data frames</em>. On peut ainsi facilement convertir un <em>data frame</em> en tibble avec <code>as_tibble</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32 × 11
     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  21       6  160    110  3.9   2.62  16.5     0     1     4     4
 2  21       6  160    110  3.9   2.88  17.0     0     1     4     4
 3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
 4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
 5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
 6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
 7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
 8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
 9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
# ℹ 22 more rows</code></pre>
</div>
</div>
<p>Il est intéressant de noter qu’un <em>tibble</em> est un <em>data frame</em> mais que l’inverse n’est pas vrai !</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.data.frame</span>(mtcars) <span class="co">#TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is_tibble</span>(mtcars) <span class="co"># FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.data.frame</span>(<span class="fu">as_tibble</span>(mtcars)) <span class="co">#TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is_tibble</span>(<span class="fu">as_tibble</span>(mtcars)) <span class="co">#TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Si le <em>data frame</em> d’origine a des <em>rownames</em>, on peut d’abord les convertir en colonnes avec <code>rownames_to_columns</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">rownames_to_column</span>(mtcars))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32 × 12
   rowname       mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 Mazda RX4    21       6  160    110  3.9   2.62  16.5     0     1     4     4
 2 Mazda RX4 …  21       6  160    110  3.9   2.88  17.0     0     1     4     4
 3 Datsun 710   22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
 4 Hornet 4 D…  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
 5 Hornet Spo…  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
 6 Valiant      18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
 7 Duster 360   14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
 8 Merc 240D    24.4     4  147.    62  3.69  3.19  20       1     0     4     2
 9 Merc 230     22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
10 Merc 280     19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
# ℹ 22 more rows</code></pre>
</div>
</div>
<p>À l’inverse, on peut à tout moment convertir un tibble en <em>data frame</em> avec <code>as.data.frame</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               rowname  mpg cyl  disp  hp drat    wt  qsec vs am gear carb
1            Mazda RX4 21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
2        Mazda RX4 Wag 21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
3           Datsun 710 22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
4       Hornet 4 Drive 21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
5    Hornet Sportabout 18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
6              Valiant 18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
7           Duster 360 14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
8            Merc 240D 24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
9             Merc 230 22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
10            Merc 280 19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
11           Merc 280C 17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
12          Merc 450SE 16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
13          Merc 450SL 17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
14         Merc 450SLC 15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
15  Cadillac Fleetwood 10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
16 Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
17   Chrysler Imperial 14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
18            Fiat 128 32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
19         Honda Civic 30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
20      Toyota Corolla 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
21       Toyota Corona 21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
22    Dodge Challenger 15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
23         AMC Javelin 15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
24          Camaro Z28 13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
25    Pontiac Firebird 19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
26           Fiat X1-9 27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
27       Porsche 914-2 26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
28        Lotus Europa 30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
29      Ford Pantera L 15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
30        Ferrari Dino 19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
31       Maserati Bora 15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
32          Volvo 142E 21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
</div>
</div>
<p>Là encore, on peut convertir la colonne <code>rowname</code> en “vrais” <em>rownames</em> avec <code>column_to_rownames</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">column_to_rownames</span>(<span class="fu">as.data.frame</span>(d))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     mpg cyl  disp  hp drat    wt  qsec vs am gear carb
Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Les deux fonctions <code>column_to_rownames</code> et <code>rownames_to_column</code> acceptent un argument supplémentaire <code>var</code> qui permet d’indiquer un nom de colonne autre que le nom <code>rowname</code> utilisé par défaut pour créer ou identifier la colonne contenant les noms de lignes.</p>
</div>
</div>
<p>Normalement, vous ne devriez trop à avoir à vous soucier de la différence entre un <em>data frame</em> et un <em>tibble</em> dans le sens où la plupart des fonctions que nous allons utiliser acceptent les deux !</p>
</section>
<section id="sec-vectorfactor" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Recoder des variables</h1>
<p>Dans cette section, nous allons nous intéresser aux types des données lues par R et à comment il est possible de faire certains changements.</p>
<section id="sec-vecteurs" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="sec-vecteurs"><span class="header-section-number">4.1</span> Rappel sur les variables et les vecteurs</h2>
<p>Dans R, une variable, en général une colonne d’un tableau de données, est un objet de type <em>vecteur</em>. Un vecteur est un ensemble d’éléments, tous du même type.</p>
<p>On a vu qu’on peut construire un vecteur manuellement de différentes manières&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>couleur <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Jaune"</span>, <span class="st">"Jaune"</span>, <span class="st">"Rouge"</span>, <span class="st">"Vert"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>nombres <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Mais le plus souvent on manipule des vecteurs faisant partie d’une table importée dans R.</p>
<p>Pour la suite, nous allons utiliser le jeux de données <em>Star Wars</em> et essayer de faire un peu de nettoyage !</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>sw <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/StarWars_characters.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Quand on veut accéder à un vecteur d’un tableau de données, on peut utiliser l’opérateur <code>$</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>sw<span class="sc">$</span>name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Les vecteurs peuvent être de classes différentes, selon le type de données qu’ils contiennent.</p>
<p>On a ainsi des vecteurs de type <code>integer</code> ou <code>double</code>, qui contiennent respectivement des nombres entiers ou décimaux. Dans notre exemple, nous avons simplement une colonne de type <code>integer</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(sw<span class="sc">$</span>height)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
</div>
<p>Des vecteurs de type <code>character</code>, qui contiennent des chaînes de caractères&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(sw<span class="sc">$</span>name)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sw<span class="sc">$</span>name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Et des vecteurs de type <code>logical</code>, qui ne peuvent contenir que les valeurs vraie (<code>TRUE</code>) ou fausse (<code>FALSE</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(vec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "logical"</code></pre>
</div>
</div>
<p>On peut convertir un vecteur d’un type en un autre en utilisant les fonctions <code>as.numeric</code>, <code>as.character</code> ou <code>as.logical</code>. Les valeurs qui n’ont pas pu être converties sont automatiquement transformées en <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2.35"</span>, <span class="st">"8.2e+03"</span>, <span class="st">"foo"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduits lors de la conversion automatique</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]    1.00    2.35 8200.00      NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.character</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2" "3" "4" "5" "6"</code></pre>
</div>
</div>
<p>Dans nos données, nous voyons que la colonne <code>mass</code> a été importée comme étant de type <code>character</code> alors qu’il s’agit de nombre. Cela vient probablement du fait qu’un des nombre est mal formaté. La fonction <code>as.numeric</code> affiche normalement un warning lorsque qu’un élément n’a pas pu être converti.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(sw<span class="sc">$</span>mass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduits lors de la conversion automatique</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  77.0  75.0  32.0 136.0  49.0 120.0  75.0  32.0  84.0  77.0  84.0    NA
[13] 112.0  80.0  74.0    NA  77.0 110.0  17.0  75.0  78.2 140.0 113.0  79.0
[25]  79.0  83.0    NA    NA  20.0  68.0  89.0  90.0    NA  66.0  82.0    NA
[37]    NA    NA  40.0    NA    NA  80.0    NA  55.0  45.0    NA  65.0  84.0
[49]  82.0  87.0    NA  50.0    NA    NA  80.0    NA  85.0    NA    NA  80.0
[61]  56.2  50.0    NA  80.0    NA  79.0  55.0 102.0  88.0    NA    NA  15.0
[73]    NA  48.0    NA  57.0 159.0 136.0  79.0  48.0  80.0    NA    NA    NA
[85]    NA    NA  45.0</code></pre>
</div>
</div>
<p>En allant jeter un coup d’oeil dans les données, nous voyons que la masse pour <em>Jabba Desilijic Tiure</em> comporte une vigule à la place d’un point pour séparer les décimales<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Nous pouvons faire un remplacement des virgules en points pour cette colonne avec la fonction <code>gsub</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>sw<span class="sc">$</span>mass <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">"."</span>, sw<span class="sc">$</span>mass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous pouvons maintenant faire notre conversion de type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>sw<span class="sc">$</span>mass <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(sw<span class="sc">$</span>mass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-tests" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="sec-tests"><span class="header-section-number">4.2</span> Tests et comparaison</h2>
<p>Un test est une opération logique de comparaison qui renvoie vrai (<code>TRUE</code>) ou faux (<code>FALSE</code>) pour chacun des éléments d’un vecteur.</p>
<p>Parmi les opérateurs de comparaison disponibles, on trouve notamment&nbsp;:</p>
<ul>
<li><code>==</code> qui teste l’égalité</li>
<li><code>!=</code> qui teste la différence</li>
<li><code>&gt;</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;=</code> qui testent la supériorité ou l’infériorité</li>
<li><code>%in%</code> qui teste l’appartenance à un ensemble de valeurs</li>
</ul>
<p>Exemple le plus simple&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">==</span> <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">!=</span> <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Exemple appliqué à un vecteur&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>x <span class="sc">&lt;</span> <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE</code></pre>
</div>
</div>
<p>On peut combiner plusieurs tests avec les opérateurs logiques <em>et</em> (<code>&amp;</code>) et <em>ou</em> (<code>|</code>). Ainsi, si on veut tester qu’une valeur est comprise entre 3 et 6 inclus, on peut faire&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">&gt;=</span> <span class="dv">3</span> <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> <span class="dv">6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] FALSE FALSE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE</code></pre>
</div>
</div>
<p>Si on veut tester qu’une valeur est égale à “Bleu” ou à “Vert”, on peut faire&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Jaune"</span>, <span class="st">"Jaune"</span>, <span class="st">"Rouge"</span>, <span class="st">"Vert"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>vec <span class="sc">==</span> <span class="st">"Jaune"</span> <span class="sc">|</span> vec <span class="sc">==</span> <span class="st">"Vert"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE  TRUE FALSE  TRUE</code></pre>
</div>
</div>
<p>À noter que dans ce cas, on peut utiliser l’opérateur <code>%in%</code><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>, qui teste si une valeur fait partie des éléments d’un vecteur&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>vec <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Jaune"</span>, <span class="st">"Vert"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE  TRUE FALSE  TRUE</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Attention, si on souhaite tester si une valeur <code>x</code> est inconnue (ou ‘manquante’), c’est-à-dire si elle est codée <code>NA</code> (<em>Not Available</em>), faire le test <code>x == NA</code> <em>ne donnera pas le résultat escompté</em>. En effet, fidèle à sa réputation de rigueur informaticienne, pour R <code>NA == NA</code> ne vaut pas <code>TRUE</code> mais… <code>NA</code> (on ne sait pas si une valeur inconnue est égale à une autre valeur inconnue).</p>
<p>Pour tester si une valeur est inconnue (<code>NA</code>), il faut utiliser la fonction dédiée <code>is.na</code> et faire <code>is.na(x)</code>.</p>
<p>Cependant, par convention, <code>NA %in% NA</code> vaut <code>TRUE</code>.</p>
</div>
</div>
<p>Enfin, on peut inverser un test avec l’opérateur <em>non</em> (<code>!</code>)&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="sc">!</span>(vec <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Jaune"</span>, <span class="st">"Vert"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE  TRUE FALSE</code></pre>
</div>
</div>
<p>Les tests sont notamment utilisés par le verbe <code>filter</code> de <code>dplyr</code> (que nous verrons plus loin) qui permet de sélectionner certaines lignes d’un tableau de données. On peut ainsi sélectionner les personnages de plus de 1 mètre&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(sw, height <span class="sc">&gt;=</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ou sélectionner les personnages ayant comme <em>homeworld</em> Tatooine ou Naboo :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(sw, homeworld <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Tatooine"</span>, <span class="st">"Naboo"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut utiliser les tests pour sélectionner certains éléments d’un vecteur. Si on passe un test à l’opérateur de sélection <code>[]</code>, seuls les éléments pour lesquels ce test est vrai seront conservés&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">8</span>, <span class="dv">14</span>, <span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">18</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>x[x <span class="sc">&gt;</span> <span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12 14 18</code></pre>
</div>
</div>
<p>Enfin, on peut aussi utiliser les tests et la sélection pour modifier les valeurs d’un vecteur. Ainsi, si on assigne une valeur à une sélection, les éléments pour lesquels le test est vrai sont remplacés par cette valeur&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">8</span>, <span class="dv">14</span>, <span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">18</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>x[x <span class="sc">&gt;</span> <span class="dv">10</span>] <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100   8 100   7   6 100</code></pre>
</div>
</div>
<p>En utilisant cette assignation via un test, on peut effectuer des recodages de variables. Soit le vecteur suivant&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Femme"</span>, <span class="st">"Homme"</span>, <span class="st">"Femme"</span>, <span class="st">"Garçon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si on souhaite recoder la modalité “Garçon” en “Homme”, on peut utiliser la syntaxe suivante&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>vec[vec <span class="sc">==</span> <span class="st">"Garçon"</span>] <span class="ot">&lt;-</span> <span class="st">"Homme"</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>vec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Femme" "Homme" "Femme" "Homme"</code></pre>
</div>
</div>
<p>Cette syntaxe est tout à fait valable et couramment utilisée. On va cependant voir dans la section suivante différentes fonctions qui facilitent ces opérations de recodage.</p>
<p>Dans notre exemple, si nous regardons la colonne <em>gender</em>, nous voyons une valeur <code>"none"</code> qui n’a pas été comptée comme <code>NA</code>. D’ailleurs, tous les <code>NA</code> sont en faite des droids. Nous allons donc changer les <code>NA</code> et les <code>"none"</code> en <code>"droid"</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>sw<span class="sc">$</span>gender[sw<span class="sc">$</span>gender <span class="sc">==</span> <span class="st">"none"</span> <span class="sc">|</span> <span class="fu">is.na</span>(sw<span class="sc">$</span>gender)] <span class="ot">&lt;-</span> <span class="st">"droid"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-recoder-une-variable-qualitative" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="sec-recoder-une-variable-qualitative"><span class="header-section-number">4.3</span> Recoder une variable qualitative</h2>
<p>Pour rappel, on appelle variable qualitative une variable pouvant prendre un nombre limité de modalités (de valeurs possibles).</p>
<section id="sec-facteurs" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="sec-facteurs"><span class="header-section-number">4.3.1</span> Facteurs et <code>forcats</code></h3>
<p>Dans R, les variables qualitatives peuvent être de deux types&nbsp;: ou bien des vecteurs de type <code>character</code> (des chaînes de caractères), ou bien des <code>factor</code> (facteurs). Si vous utilisez les fonctions des extensions du <em>tidyverse</em> comme <code>readr</code>, <code>readxl</code> ou <code>haven</code> pour importer vos données, vos variables qualitatives seront importées sous forme de <code>character</code>. Mais dans d’autres cas elles se retrouveront parfois sous forme de <code>factor</code>.</p>
<p>Pour convertir une colonne en <code>factors</code>, nous pouvons utiliser la fonction <code>as_factor</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>sw<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(sw<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Les facteurs sont un type de variable ne pouvant prendre qu’un nombre défini de modalités nommés <em>levels</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(sw<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "male"          "droid"         "female"        "hermaphrodite"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_count</span>(sw<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  f                 n
  &lt;fct&gt;         &lt;int&gt;
1 male             62
2 droid             5
3 female           19
4 hermaphrodite     1</code></pre>
</div>
</div>
<p>Ceci complique les opérations de recodage car du coup l’opération suivante, qui tente de modifier une modalité de la variable, aboutit à un avertissement, et l’opération n’est pas effectuée.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>sw<span class="sc">$</span>gender[sw<span class="sc">$</span>gender <span class="sc">==</span> <span class="st">"male"</span>] <span class="ot">&lt;-</span> <span class="st">"homme"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>forcats</code> est une extension facilitant la manipulation des variables qualitatives, qu’elles soient sous forme de vecteurs <code>character</code> ou de facteurs. Elle fait partie du <em>tidyverse</em>, et est donc automatiquement chargée par&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-recode" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="sec-recode"><span class="header-section-number">4.3.2</span> Modifier les modalités d’une variable qualitative</h3>
<p>Une opération courante consiste à modifier les valeurs d’une variable qualitative, que ce soit pour avoir des intitulés plus courts ou plus clairs ou pour regrouper des modalités entre elles.</p>
<p>Il existe plusieurs possibilités pour effectuer ce type de recodage, mais ici on va utiliser la fonction <code>fct_recode</code> de l’extension <code>forcats</code>. Celle-ci prend en argument une liste de recodages sous la forme <code>"Nouvelle valeur" = "Ancienne valeur"</code>.</p>
<p>Un exemple&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Pomme"</span>, <span class="st">"Poire"</span>, <span class="st">"Pomme"</span>, <span class="st">"Cerise"</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">fct_recode</span>(</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    f,</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Fraise"</span> <span class="ot">=</span> <span class="st">"Pomme"</span>,</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Ananas"</span> <span class="ot">=</span> <span class="st">"Poire"</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Fraise Ananas Fraise Cerise
Levels: Cerise Ananas Fraise</code></pre>
</div>
</div>
<p>Si on veut par exemple traduire nos genres dans notre jeu de données</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>sw<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">fct_recode</span>(</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    sw<span class="sc">$</span>gender,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"homme"</span> <span class="ot">=</span> <span class="st">"male"</span>,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"femme"</span> <span class="ot">=</span> <span class="st">"female"</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_count</span>(sw<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  f                 n
  &lt;fct&gt;         &lt;int&gt;
1 homme            62
2 droid             5
3 femme            19
4 hermaphrodite     1</code></pre>
</div>
</div>
<p>Attention, les anciennes valeurs saisies doivent être exactement égales aux valeurs des modalités de la variable recodée&nbsp;: toute différence d’accent ou d’espace fera que ce recodage ne sera pas pris en compte. Dans ce cas, <code>forcats</code> affiche un avertissement nous indiquant qu’une valeur saisie n’a pas été trouvée dans les modalités de la variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>sw<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">fct_recode</span>(</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>    sw<span class="sc">$</span>gender,</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"hermaphrodite"</span> <span class="ot">=</span> <span class="st">"hérmaphrodite"</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Unknown levels in `f`: hérmaphrodite</code></pre>
</div>
</div>
<p>Si on souhaite recoder une modalité de la variable en <code>NA</code>, il faut (contre intuitivement) lui assigner la valeur <code>NULL</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>sw<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">fct_recode</span>(</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>    sw<span class="sc">$</span>gender,</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">NULL =</span> <span class="st">"droid"</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_count</span>(sw<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  f                 n
  &lt;fct&gt;         &lt;int&gt;
1 homme            62
2 femme            19
3 hermaphrodite     1
4 &lt;NA&gt;              5</code></pre>
</div>
</div>
<p>À l’inverse, si on souhaite recoder les <code>NA</code> d’une variable, on utilisera la fonction <code>fct_na_value_to_level</code>, qui convertit toutes les valeurs manquantes (<code>NA</code>) d’un facteur en une modalité spécifique.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>sw<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">fct_na_value_to_level</span>(sw<span class="sc">$</span>gender, <span class="at">level =</span> <span class="st">"droid"</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_count</span>(sw<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  f                 n
  &lt;fct&gt;         &lt;int&gt;
1 homme            62
2 femme            19
3 hermaphrodite     1
4 droid             5</code></pre>
</div>
</div>
<p>D’autres fonctions sont proposées par <code>forcats</code> pour faciliter certains recodage, comme <code>fct_collapse</code>, qui propose une autre syntaxe pratique quand on doit regrouper ensemble des modalités. Par exemple, si nous avions différentes orthographe pour les mêmes valeurs (ici il nous dira qu’il ne connait pas certains <em>levels</em> ce qui est normale) :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>sw<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">fct_collapse</span>(</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>    sw<span class="sc">$</span>gender,</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"male"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"homme"</span>, <span class="st">"Homme"</span>),</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"female"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"femme"</span>, <span class="st">"Femme"</span>)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Unknown levels in `f`: Homme, Femme</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_count</span>(sw<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  f                 n
  &lt;fct&gt;         &lt;int&gt;
1 male             62
2 female           19
3 hermaphrodite     1
4 droid             5</code></pre>
</div>
</div>
<p>N’hésitez pas à consulter la documentation de <a href="https://forcats.tidyverse.org/"><code>focats</code></a> et sa <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/factors.pdf">Cheat Sheet</a> !</p>
</section>
<section id="ordonner-les-modalités-dune-variable-qualitative" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="ordonner-les-modalités-dune-variable-qualitative"><span class="header-section-number">4.3.3</span> Ordonner les modalités d’une variable qualitative</h3>
<p>L’avantage des facteurs (par rapport aux vecteurs de type <code>character</code>) est que leurs modalités peuvent être ordonnées, ce qui peut faciliter la lecture de tableaux ou graphiques.</p>
<p>On peut ordonner les modalités d’un facteur manuellement, par exemple avec la fonction <code>fct_relevel()</code> de l’extension <code>forcats</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>sw<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">fct_relevel</span>(</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    sw<span class="sc">$</span>gender,</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"male"</span>, <span class="st">"female"</span>, <span class="st">"droid"</span>,</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"hermaphrodite"</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_count</span>(sw<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  f                 n
  &lt;fct&gt;         &lt;int&gt;
1 male             62
2 female           19
3 droid             5
4 hermaphrodite     1</code></pre>
</div>
</div>
<p>Une autre possibilité est d’ordonner les modalités d’un facteur selon les valeurs d’une autre variable. Par exemple, si nous voulons étudier la taille en fonction de l’espèce&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>sw<span class="sc">$</span>species <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(sw<span class="sc">$</span>species)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>sw<span class="sc">$</span>species <span class="ot">&lt;-</span> <span class="fu">fct_na_value_to_level</span>(sw<span class="sc">$</span>species, <span class="at">level =</span> <span class="st">"Unknown"</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sw) <span class="sc">+</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> species, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SFC1018_Traitement_R_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Le graphique pourrait être plus lisible si les modalités étaient triées par la taille mediane croissante. On peut dans ce cas utiliser la fonction <code>fct_reorder</code>. Celle-ci prend 3 arguments&nbsp;: le facteur à réordonner, la variable dont les valeurs doivent être utilisées pour ce réordonnancement, et enfin une fonction à appliquer à cette deuxième variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>sw<span class="sc">$</span>spec_heigt <span class="ot">&lt;-</span> <span class="fu">fct_reorder</span>(sw<span class="sc">$</span>species, sw<span class="sc">$</span>height, median)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sw) <span class="sc">+</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> spec_heigt, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SFC1018_Traitement_R_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>On peut aussi effectuer le réordonnancement directement dans l’appel à <code>ggplot2</code>, sans créer de nouvelle variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sw) <span class="sc">+</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">fct_reorder</span>(species, height, median),</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> height</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lorsqu’on effectue un diagramme en barres avec <code>geom_bar</code>, on peut aussi réordonner les modalités selon leurs effectifs à l’aide de <code>fct_infreq</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sw) <span class="sc">+</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_infreq</span>(species)))<span class="sc">+</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SFC1018_Traitement_R_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-if-else" class="level3" data-number="4.3.4">
<h3 data-number="4.3.4" class="anchored" data-anchor-id="sec-if-else"><span class="header-section-number">4.3.4</span> <code>ifelse</code></h3>
<p><code>ifelse</code> prend trois arguments&nbsp;: un test, une valeur à renvoyer si le test est vrai, et une valeur à renvoyer si le test est faux.</p>
<p>Voici un exemple simple&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">14</span>, <span class="dv">8</span>, <span class="dv">16</span>)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(v <span class="sc">&gt;</span> <span class="dv">10</span>, <span class="st">"Supérieur à 10"</span>, <span class="st">"Inférieur à 10"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Supérieur à 10" "Supérieur à 10" "Inférieur à 10" "Supérieur à 10"</code></pre>
</div>
</div>
<p>La fonction permet d’utiliser des tests combinant plusieurs variables. Par exemple, imaginons qu’on souhaite créer une nouvelle variable indiquant les hommes de plus de 180cm&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>sw<span class="sc">$</span>cat <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>    sw<span class="sc">$</span>gender <span class="sc">==</span> <span class="st">"male"</span> <span class="sc">&amp;</span> sw<span class="sc">$</span>height <span class="sc">&gt;</span> <span class="dv">180</span>,</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Homme grand"</span>,</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Autre"</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="fu">view</span>(sw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="case_when" class="level3" data-number="4.3.5">
<h3 data-number="4.3.5" class="anchored" data-anchor-id="case_when"><span class="header-section-number">4.3.5</span> <code>case_when</code></h3>
<p><code>case_when</code> est une généralisation du <code>ifelse</code> qui permet d’indiquer plusieurs tests et leurs valeurs associées.</p>
<p>Imaginons qu’on souhaite créer une nouvelle variable permettant d’identifier les hommes de plus de 60 ans, les femmes de plus de 60 ans, et les autres. On peut utiliser la syntaxe suivante&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>sw<span class="sc">$</span>cat <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>    sw<span class="sc">$</span>height <span class="sc">&gt;</span> <span class="dv">180</span> <span class="sc">&amp;</span> sw<span class="sc">$</span>gender <span class="sc">==</span> <span class="st">"male"</span> <span class="sc">~</span> <span class="st">"Homme grand"</span>,</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>    sw<span class="sc">$</span>height <span class="sc">&gt;</span> <span class="dv">180</span> <span class="sc">&amp;</span> sw<span class="sc">$</span>gender <span class="sc">==</span> <span class="st">"female"</span> <span class="sc">~</span> <span class="st">"Femme grande"</span>,</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Autre"</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(sw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>case_when</code> prend en arguments une série d’instructions sous la forme <code>condition ~ valeur</code>. Il les exécute une par une, et dès qu’une <code>condition</code> est vraie, il renvoie la <code>valeur</code> associée.</p>
<p>La dernière clause <code>TRUE ~ "Autre"</code> permet d’assigner une valeur à toutes les lignes pour lesquelles aucune des conditions précédentes n’est vraie.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Attention&nbsp;:</strong> comme les conditions sont testées l’une après l’autre et que la valeur renvoyée est celle correspondant à la première condition vraie, l’ordre de ces conditions est très important. Il faut absolument aller du plus spécifique au plus général.</p>
</div>
</div>
</section>
</section>
<section id="découper-une-variable-numérique-en-classes" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="découper-une-variable-numérique-en-classes"><span class="header-section-number">4.4</span> Découper une variable numérique en classes</h2>
<p>Une autre opération courante consiste à découper une variable numérique en classes. Par exemple, on voudra transformer une variable <em>height</em> en une variable qualitative avec des catégories <em>Moins de 150cm</em>, <em>150-180 cm</em>, etc.</p>
<p>On utilise pour cela la fonction <code>cut()</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>sw<span class="sc">$</span>heightcl <span class="ot">&lt;-</span> <span class="fu">cut</span>(sw<span class="sc">$</span>height, <span class="at">breaks =</span> <span class="dv">5</span>)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_count</span>(sw<span class="sc">$</span>heightcl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  f              n
  &lt;fct&gt;      &lt;int&gt;
1 (65.8,106]     7
2 (106,145]      3
3 (145,185]     42
4 (185,224]     25
5 (224,264]      4
6 &lt;NA&gt;           6</code></pre>
</div>
</div>
<p>Si on donne un nombre entier à l’argument <code>breaks</code>, un nombre correspondant de classes d’amplitudes égales sont automatiquement calculées. Comme il est souvent préférable d’avoir des limites “arrondies”, on peut aussi spécifier ces dernières manuellement en passant un vecteur à <code>breaks</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>sw<span class="sc">$</span>heightcl <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>    sw<span class="sc">$</span>height,</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">150</span>, <span class="dv">175</span>, <span class="dv">185</span>, <span class="dv">200</span>, <span class="dv">225</span>, <span class="dv">300</span>)</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_count</span>(sw<span class="sc">$</span>heightcl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  f             n
  &lt;fct&gt;     &lt;int&gt;
1 (50,150]     12
2 (150,175]    21
3 (175,185]    20
4 (185,200]    18
5 (200,225]     6
6 (225,300]     4
7 &lt;NA&gt;          6</code></pre>
</div>
</div>
</section>
</section>
<section id="manipuler-des-chaines-de-caractères" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Manipuler des chaines de caractères</h1>
<p>Les fonctions de <code>forcats</code> vues précédemment permettent de modifier des modalités d’une variables qualitative globalement. Mais parfois on a besoin de manipuler le contenu même du texte d’une variable de type chaîne de caractères&nbsp;: combiner, rechercher, remplacer…</p>
<p>On va utiliser ici les fonctions de l’extension <code>stringr</code>. Celle-ci fait partie du coeur du <em>tidyverse</em>, elle est donc automatiquement chargée avec&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>stringr</code> est en fait une interface simplifiée aux fonctions d’une autre extension, <code>stringi</code>. Si les fonctions de <code>stringr</code> ne sont pas suffisantes ou si vous manipulez beaucoup de chaînes de caractères, n’hésitez pas à vous reporter à la documentation de <code>stringi</code>.</p>
</div>
</div>
<p>Dans ce qui suit on va utiliser le court tableau d’exemple <code>d</code> suivant&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">nom =</span> <span class="fu">c</span>(<span class="st">"Mr Félicien Machin"</span>, <span class="st">"Mme Raymonde Bidule"</span>, <span class="st">"M. Martial Truc"</span>, <span class="st">"Mme Huguette Chose"</span>),</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">adresse =</span> <span class="fu">c</span>(<span class="st">"3 rue des Fleurs"</span>, <span class="st">"47 ave de la Libération"</span>, <span class="st">"12 rue du 17 octobre 1961"</span>, <span class="st">"221 avenue de la Libération"</span>),</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ville =</span> <span class="fu">c</span>(<span class="st">"Laval"</span>, <span class="st">"Montréal"</span>, <span class="st">"Québec"</span>, <span class="st">"Montréal"</span>)</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">nom</th>
<th style="text-align: left;">adresse</th>
<th style="text-align: left;">ville</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Mr Félicien Machin</td>
<td style="text-align: left;">3 rue des Fleurs</td>
<td style="text-align: left;">Laval</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mme Raymonde Bidule</td>
<td style="text-align: left;">47 ave de la Libération</td>
<td style="text-align: left;">Montréal</td>
</tr>
<tr class="odd">
<td style="text-align: left;">M. Martial Truc</td>
<td style="text-align: left;">12 rue du 17 octobre 1961</td>
<td style="text-align: left;">Québec</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mme Huguette Chose</td>
<td style="text-align: left;">221 avenue de la Libération</td>
<td style="text-align: left;">Montréal</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="sec-concat" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="sec-concat"><span class="header-section-number">5.1</span> Concaténer des chaînes</h2>
<p>La première opération de base consiste à concaténer des chaînes de caractères entre elles. On peut le faire avec la fonction <code>paste</code>.</p>
<p>Par exemple, si on veut concaténer l’adresse et la ville&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(d<span class="sc">$</span>adresse, d<span class="sc">$</span>ville)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "3 rue des Fleurs Laval"              
[2] "47 ave de la Libération Montréal"    
[3] "12 rue du 17 octobre 1961 Québec"    
[4] "221 avenue de la Libération Montréal"</code></pre>
</div>
</div>
<p>Par défaut, <code>paste</code> concatène en ajoutant un espace entre les différentes chaînes. On peut spécifier un autre séparateur avec son argument <code>sep</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(d<span class="sc">$</span>adresse, d<span class="sc">$</span>ville, <span class="at">sep =</span> <span class="st">" - "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "3 rue des Fleurs - Laval"              
[2] "47 ave de la Libération - Montréal"    
[3] "12 rue du 17 octobre 1961 - Québec"    
[4] "221 avenue de la Libération - Montréal"</code></pre>
</div>
</div>
<p>Il existe une variante, <code>paste0</code>, qui concatène sans mettre de séparateur, et qui est légèrement plus rapide&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(d<span class="sc">$</span>adresse, d<span class="sc">$</span>ville)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "3 rue des FleursLaval"               "47 ave de la LibérationMontréal"    
[3] "12 rue du 17 octobre 1961Québec"     "221 avenue de la LibérationMontréal"</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>À noter que <code>paste</code> et <code>paste0</code> sont des fonctions R de base. L’équivalent pour <code>stringr</code> se nomme <code>str_c</code>.</p>
</div>
</div>
<p>Parfois on cherche à concaténer les différents éléments d’un vecteur non pas avec ceux d’un autre vecteur, comme on l’a fait précédemment, mais <em>entre eux</em>. Dans ce cas <code>paste</code> seule ne fera rien&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(d<span class="sc">$</span>ville)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Laval"    "Montréal" "Québec"   "Montréal"</code></pre>
</div>
</div>
<p>Il faut lui ajouter un argument <code>collapse</code>, avec comme valeur la chaîne à utiliser pour concaténer les éléments&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(d<span class="sc">$</span>ville, <span class="at">collapse =</span> <span class="st">", "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Laval, Montréal, Québec, Montréal"</code></pre>
</div>
</div>
</section>
<section id="convertir-en-majuscules-minuscules" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="convertir-en-majuscules-minuscules"><span class="header-section-number">5.2</span> Convertir en majuscules / minuscules</h2>
<p>Les fonctions <code>str_to_lower</code>, <code>str_to_upper</code> et <code>str_to_title</code> permettent respectivement de mettre en minuscules, mettre en majuscules, ou de capitaliser les éléments d’un vecteur de chaînes de caractères&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_to_lower</span>(d<span class="sc">$</span>nom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "mr félicien machin"  "mme raymonde bidule" "m. martial truc"    
[4] "mme huguette chose" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_to_upper</span>(d<span class="sc">$</span>nom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MR FÉLICIEN MACHIN"  "MME RAYMONDE BIDULE" "M. MARTIAL TRUC"    
[4] "MME HUGUETTE CHOSE" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_to_title</span>(d<span class="sc">$</span>nom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mr Félicien Machin"  "Mme Raymonde Bidule" "M. Martial Truc"    
[4] "Mme Huguette Chose" </code></pre>
</div>
</div>
</section>
<section id="découper-des-chaînes" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="découper-des-chaînes"><span class="header-section-number">5.3</span> Découper des chaînes</h2>
<p>La fonction <code>str_split</code> permet de “découper” une chaîne de caractère en fonction d’un délimiteur. On passe la chaîne en premier argument, et le délimiteur en second&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(<span class="st">"un-deux-trois"</span>, <span class="st">"-"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "un"    "deux"  "trois"</code></pre>
</div>
</div>
<p>On peut appliquer la fonction à un vecteur, dans ce cas le résultat sera une liste&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(d<span class="sc">$</span>nom, <span class="st">" "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "Mr"       "Félicien" "Machin"  

[[2]]
[1] "Mme"      "Raymonde" "Bidule"  

[[3]]
[1] "M."      "Martial" "Truc"   

[[4]]
[1] "Mme"      "Huguette" "Chose"   </code></pre>
</div>
</div>
<p>Ou un tableau (plus précisément une matrice) si on ajoute <code>simplify = TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(d<span class="sc">$</span>nom, <span class="st">" "</span>, <span class="at">simplify =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]  [,2]       [,3]    
[1,] "Mr"  "Félicien" "Machin"
[2,] "Mme" "Raymonde" "Bidule"
[3,] "M."  "Martial"  "Truc"  
[4,] "Mme" "Huguette" "Chose" </code></pre>
</div>
</div>
<p>Si on souhaite créer de nouvelles colonnes dans un tableau de données en découpant une colonne de type texte, on pourra utiliser la fonction <code>separate</code> de l’extension <code>tidyr</code>. Celle-ci est expliquée <strong>?@sec-separate</strong>.</p>
<p>Voici juste un exemple de son utilisation&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">separate</span>(nom, <span class="fu">c</span>(<span class="st">"genre"</span>, <span class="st">"prenom"</span>, <span class="st">"nom"</span>), <span class="at">sep =</span> <span class="st">" "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  genre prenom   nom    adresse                     ville   
  &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;                       &lt;chr&gt;   
1 Mr    Félicien Machin 3 rue des Fleurs            Laval   
2 Mme   Raymonde Bidule 47 ave de la Libération     Montréal
3 M.    Martial  Truc   12 rue du 17 octobre 1961   Québec  
4 Mme   Huguette Chose  221 avenue de la Libération Montréal</code></pre>
</div>
</div>
</section>
<section id="extraire-des-sous-chaînes-par-position" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="extraire-des-sous-chaînes-par-position"><span class="header-section-number">5.4</span> Extraire des sous-chaînes par position</h2>
<p>La fonction <code>str_sub</code> permet d’extraire des sous-chaînes par position, en indiquant simplement les positions des premier et dernier caractères&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(d<span class="sc">$</span>ville, <span class="dv">1</span>, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Lav" "Mon" "Qué" "Mon"</code></pre>
</div>
</div>
</section>
<section id="sec-str-detect" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="sec-str-detect"><span class="header-section-number">5.5</span> Détecter des motifs</h2>
<p><code>str_detect</code> permet de détecter la présence d’un motif parmi les élements d’un vecteur. Par exemple, si on souhaite identifier toutes les adresses contenant “Libération”&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(d<span class="sc">$</span>adresse, <span class="st">"Libération"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE  TRUE FALSE  TRUE</code></pre>
</div>
</div>
<p><code>str_detect</code> renvoie un vecteur de valeurs logiques et peut donc être utilisée, par exemple, avec le verbe <code>filter</code> de <code>dplyr</code> pour extraire des sous-populations.</p>
<p>Une variante, <code>str_count</code>, compte le nombre d’occurrences d’une chaîne pour chaque élément d’un vecteur&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_count</span>(d<span class="sc">$</span>ville, <span class="st">"s"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 0 0 0</code></pre>
</div>
</div>
<p>On peut aussi utiliser <code>str_subset</code> pour ne garder d’un vecteur que les éléments correspondant au motif&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(d<span class="sc">$</span>adresse, <span class="st">"Libération"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "47 ave de la Libération"     "221 avenue de la Libération"</code></pre>
</div>
</div>
</section>
<section id="extraire-des-motifs" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="extraire-des-motifs"><span class="header-section-number">5.6</span> Extraire des motifs</h2>
<p><code>str_extract</code> permet d’extraire les valeurs correspondant à un motif. Si on lui passe comme motif une chaîne de caractère, cela aura peu d’intérêt&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(d<span class="sc">$</span>adresse, <span class="st">"Libération"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA           "Libération" NA           "Libération"</code></pre>
</div>
</div>
<p><code>str_extract</code> ne récupère que la première occurrence du motif. Si on veut toutes les extraire on peut utiliser <code>str_extract_all</code>.</p>
</section>
<section id="remplacer-des-motifs" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="remplacer-des-motifs"><span class="header-section-number">5.7</span> Remplacer des motifs</h2>
<p>La fonction <code>str_replace_all</code> permet de remplacer une chaîne ou un motif par une autre.</p>
<p>Par exemple, on peut remplacer les occurrence de “Mr” par “M.” dans notre variable <code>nom</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace_all</span>(d<span class="sc">$</span>nom, <span class="st">"Mr"</span>, <span class="st">"M."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "M. Félicien Machin"  "Mme Raymonde Bidule" "M. Martial Truc"    
[4] "Mme Huguette Chose" </code></pre>
</div>
</div>
<p>On peut également spécifier plusieurs remplacements en une seule fois&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace_all</span>(</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">$</span>adresse,</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"avenue"</span> <span class="ot">=</span> <span class="st">"Avenue"</span>, <span class="st">"ave"</span> <span class="ot">=</span> <span class="st">"Avenue"</span>, <span class="st">"rue"</span> <span class="ot">=</span> <span class="st">"Rue"</span>)</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "3 Rue des Fleurs"            "47 Avenue de la Libération" 
[3] "12 Rue du 17 octobre 1961"   "221 Avenue de la Libération"</code></pre>
</div>
</div>
</section>
<section id="ressources" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="ressources"><span class="header-section-number">5.8</span> Ressources</h2>
<p>L’ouvrage <em>R for Data Science</em>, accessible en ligne, contient <a href="http://r4ds.had.co.nz/strings.html">un chapitre entier</a> sur les chaînes de caractères et les expressions régulières (en anglais).</p>
<p>Le <a href="http://stringr.tidyverse.org/">site officiel de stringr</a> contient une <a href="http://stringr.tidyverse.org/reference/index.html">liste des fonctions</a> et les pages d’aide associées, ainsi qu’un <a href="http://stringr.tidyverse.org/articles/regular-expressions.html">article dédié aux expressions régulières</a>.</p>
<p>Pour des besoins plus pointus, on pourra aussi utiliser <a href="http://www.gagolewski.com/software/stringi/">l’extension stringi</a> sur laquelle est elle-même basée <code>stringr</code>.</p>
</section>
</section>
<section id="exercices" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Exercices</h1>
<section id="exercice-2" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="exercice-2"><span class="header-section-number">6.1</span> Exercice 2</h2>
<p>Toujours avec notre jeu de données sur les personnages de Star Wars, nous allons finir de préparer et de nettoyer nos données.</p>
<p>Normalement les colonnes <code>height</code>, <code>mass</code>, <code>gender</code> et <code>species</code> ont déjà été traitées.</p>
<p>Pour toutes les autres colonnes: - Assurez vous que toutes la valeurs <code>"none"</code> soient transformées en <code>NA</code>. - Transformez la colonne <code>homeworld</code> en facteurs et attribuez la valeur de <em>Unknown</em> pour ceux dont on ne connait le monde d’origine. - Pour la colonne <code>birth_year</code>, supprimez le <em>BBY</em> pour ne garder que le nombre et transformez cette colonne en nombre.</p>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Quand on veut utiliser des noms de ce type, on doit les entourer avec des <em>backticks</em> (`)<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Dans R de base, si une table <code>d</code> contient une colonne <code>qualif</code>, <code>d$qual</code> retournera cette colonne.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Le fait que le séparateur des décimales soit un point ou une virgule peut varier d’un système à l’autre (Mac vs Windows vs langue du système).<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Pour accéder à la page de documentation de fonctions comme <code>%in%</code>, on ne peut pas utiliser <code>?%in%</code>, qui renvoie une erreur. Vous pouvez faire <code>?"%in%"</code>, <code>help("%in%")</code> ou, dans ce cas, <code>?match</code>, car les deux fonctions sont documentées sur la même page d’aide.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>